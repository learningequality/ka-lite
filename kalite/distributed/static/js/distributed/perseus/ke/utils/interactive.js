(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",crc32=function(B,D){null==D&&(D=0);var A=0,C=0;D=-1^D;for(var E=0,F=B.length;F>E;E++)A=255&(D^B.charCodeAt(E)),C="0x"+table.substr(9*A,8),D=D>>>8^C;return Math.abs(-1^D)};module.exports=crc32;
},{}],2:[function(require,module,exports){
function cartToPolar(t,r){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)),a=Math.atan2(t[1],t[0]);return 0>a&&(a+=2*Math.PI),r||(a=180*a/Math.PI),[e,a]}function polar(t,r){return"number"==typeof t&&(t=[t,t]),r=r*Math.PI/180,[t[0]*Math.cos(r),t[1]*Math.sin(r)]}function cleanupIntervals(){_.each(intervalIDs,function(t){window.clearInterval(t)}),intervalIDs.length=0}var kpoint=require("./kpoint.js"),kvector=require("./kvector.js");require("./tex.js"),require("./tmpl.js");var Graphie=KhanUtil.Graphie=function(){},intervalIDs=[];$.extend(KhanUtil,{unscaledSvgPath:function(t){return t[0]===!0?"":$.map(t,function(t,r){return t===!0?"z":(0===r?"M":"L")+t[0]+" "+t[1]}).join("")},getDistance:function(t,r){return kpoint.distanceToPoint(t,r)},coordDiff:function(t,r){return _.map(r,function(e,a){return r[a]-t[a]})},snapCoord:function(t,r){return _.map(t,function(t,e){return KhanUtil.roundToNearest(r[e],t)})},findAngle:function(t,r,e){if(void 0===e){var a=t[0]-r[0],n=t[1]-r[1];return a||n?(180+180*Math.atan2(-n,-a)/Math.PI+360)%360:0}return KhanUtil.findAngle(t,e)-KhanUtil.findAngle(r,e)},graphs:{}}),_.extend(Graphie.prototype,{cartToPolar:cartToPolar,polar:polar});var labelDirections={center:[-.5,-.5],above:[-.5,-1],"above right":[0,-1],right:[0,-.5],"below right":[0,0],below:[-.5,0],"below left":[-1,0],left:[-1,-.5],"above left":[-1,-1]};KhanUtil.createGraphie=function(t){var r,e,a=40,n=40;$(t).css("position","relative");var i=Raphael(t);$(t).children("div").css("position","absolute");var o={"stroke-width":2,fill:"none"},s=function(t){if("number"==typeof t)return s([t,t]);var r=t[0],e=t[1];return[r*a,e*n]},l=function y(t){if("number"==typeof t)return y([t,t]);var i=t[0],o=t[1];return[(i-r[0])*a,(e[1]-o)*n]},h=function(t){if("number"==typeof t)return h([t,t]);var i=t[0],o=t[1];return[i/a+r[0],e[1]-o/n]},p=function(t){return"number"==typeof t?p([t,t]):[t[0]/a,t[1]/n]},u=function(t,r){var e=$(t),a=e.data("labelDirection");if(e.css("visibility",""),"number"==typeof a){var n=Math.cos(a),i=Math.sin(a),o=Math.min(r[0]/2/Math.abs(n),r[1]/2/Math.abs(i));e.css({marginLeft:-r[0]/2+n*o,marginTop:-r[1]/2-i*o})}else{var s=labelDirections[a||"center"];e.css({marginLeft:Math.round(r[0]*s[0]),marginTop:Math.round(r[1]*s[1])})}},c=function(t,r){return $.map(t,function(t,e){if(t===!0)return"z";var a=r?t:l(t);return(0===e?"M":"L")+KhanUtil.bound(a[0])+" "+KhanUtil.bound(a[1])}).join("")},f=function(t,e,a){var n=function(r){return(t*r+e)*r+a};if(0===t){var i=_.map(r,function(t){return[t,n(t)]});return c(i)}var o=-e/(2*t),s=Math.max(Math.abs(o-r[0]),Math.abs(o-r[1])),h=o+s,p=[o,n(o)],u=[h,n(h)],f=[p[0],p[1]-(u[1]-p[1])],v=Math.abs(p[0]-u[0]),d=[p[0]-v,u[1]],g=[p[0]+v,u[1]],i=_.map([d,f,g],l),b=_.map(_.flatten(i),KhanUtil.bound);return"M"+b[0]+","+b[1]+" Q"+b[2]+","+b[3]+" "+b[4]+","+b[5]},v=function(t,e,a,n){var i=Math.abs(Math.PI/(2*e)),o=function(r){return t*Math.sin(e*r-a)+n},s=function(r){return t*e*Math.cos(a-e*r)},h=function(t,r){var e=t+i*r,a=e+i,n=[e,2*e/3+1*a/3,1*e/3+2*a/3,a],h=[o(e),o(e)+s(e)*(a-e)/3,o(a)-s(a)*(a-e)/3,o(a)];return _.map(_.zip(n,h),l)},p=r[1]-r[0],u=Math.ceil(p/i)+1,c=a/e,f=c-r[0];c-=i*Math.ceil(f/i);for(var v=h(c,0),d="M"+v[0][0]+","+v[0][1]+" C"+v[1][0]+","+v[1][1]+" "+v[2][0]+","+v[2][1]+" "+v[3][0]+","+v[3][1],g=1;u>g;g++)v=h(c,g),d+=" C"+v[1][0]+","+v[1][1]+" "+v[2][0]+","+v[2][1]+" "+v[3][0]+","+v[3][1];return d};$.extend(KhanUtil,{svgPath:c});var d=function(t){var o={scale:function(t){"number"==typeof t&&(t=[t,t]),a=t[0],n=t[1],i.setSize((r[1]-r[0])*a,(e[1]-e[0])*n)},clipRect:function(t){var r=t[0],e=t[1];return r[1]+=e[1],{"clip-rect":l(r).concat(s(e)).join(" ")}},strokeWidth:function(t){return{"stroke-width":parseFloat(t)}},rx:function(t){return{rx:s([t,0])[0]}},ry:function(t){return{ry:s([0,t])[1]}},r:function(t){var r=s([t,t]);return{rx:r[0],ry:r[1]}}},h={};return $.each(t||{},function(t,r){var e=o[t];if("function"==typeof e)$.extend(h,e(r));else{var a=t.replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase();h[a]=r}}),h},g=function x(t){var r=t.constructor.prototype;if(r===Raphael.el){if("path"===t.type&&"undefined"==typeof t.arrowheadsDrawn){var e=t.attr("stroke-width"),a=.6+.4*e,n=t.getTotalLength(),o=i.set(),s=i.path("M-3 4 C-2.75 2.5 0 0.25 0.75 0C0 -0.25 -2.75 -2.5 -3 -4"),l=t.getPointAtLength(n-.4),h=t.getPointAtLength(n-.75*a),p=180*Math.atan2(l.y-h.y,l.x-h.x)/Math.PI,u=t.attr();delete u.path;var c=t.getSubpath(0,n-.75*a);return c=i.path(c).attr(u),c.arrowheadsDrawn=!0,t.remove(),s.rotate(p,.75,0).scale(a,a,.75,0).translate(h.x,h.y).attr(u).attr({"stroke-linejoin":"round","stroke-linecap":"round"}),s.arrowheadsDrawn=!0,o.push(c),o.push(s),o}}else if(r===Raphael.st)for(var f=0,n=t.items.length;n>f;f++)x(t.items[f]);return t},b={circle:function(t,r){return i.ellipse.apply(i,l(t).concat(s([r,r])))},rect:function(t,r,e,a){var n=l([t,r+a]),o=s([e,a]);return i.rect.apply(i,n.concat(o))},ellipse:function(t,r){return i.ellipse.apply(i,l(t).concat(s(r)))},fixedEllipse:function(t,r,e){var a=l(t),n=s(r),i=2,o=2*n[0]*e+i,h=2*n[1]*e+i,p=a[0]-o/2,u=a[1]-h/2,c=document.createElement("div");$(c).css({position:"absolute",width:o+"px",height:h+"px",left:p+"px",top:u+"px"});var f=Raphael(c,o,h),v=f.ellipse(o/2,h/2,n[0],n[1]);return{wrapper:c,visibleShape:v}},arc:function(t,r,e,a,n){e=(e%360+360)%360,a=(a%360+360)%360;var o=l(t),h=s(r),p=polar(r,e),u=polar(r,a),c=l([t[0]+p[0],t[1]+p[1]]),f=l([t[0]+u[0],t[1]+u[1]]),v=((a-e)%360+360)%360>180;return i.path("M"+c.join(" ")+"A"+h.join(" ")+" 0 "+(v?1:0)+" 0 "+f.join(" ")+(n?"L"+o.join(" ")+"z":""))},path:function(t){var r=i.path(c(t));return r.graphiePath=t,r},fixedPath:function(t,r,e){t=_.map(t,l),r=r?l(r):null,e=e||c;var a=_.min(_.pluck(t,0)),n=_.max(_.pluck(t,0)),i=_.min(_.pluck(t,1)),o=_.max(_.pluck(t,1)),s=[4,4],h=[a,i];t=_.map(t,function(t){return kvector.add(kvector.subtract(t,h),kvector.scale(s,.5))});var p=n-a+s[0],u=o-i+s[1],f=h[0]-s[0]/2,v=h[1]-s[1]/2,d=document.createElement("div");$(d).css({position:"absolute",width:p+"px",height:u+"px",left:f+"px",top:v+"px",transformOrigin:r?p/2+r[0]+"px "+(u/2+r[1])+"px":null});var g=Raphael(d,p,u),b=g.path(e(t));return{wrapper:d,visibleShape:b}},scaledPath:function(t){var r=i.path(c(t,!0));return r.graphiePath=t,r},line:function(t,r){return this.path([t,r])},parabola:function(t,r,e){return i.path(f(t,r,e))},fixedLine:function(t,r,e){var a=[e,e];t=l(t),r=l(r);var n=[Math.min(t[0],r[0]),Math.min(t[1],r[1])];t=kvector.add(kvector.subtract(t,n),kvector.scale(a,.5)),r=kvector.add(kvector.subtract(r,n),kvector.scale(a,.5));var i=n[0]-a[0]/2,o=n[1]-a[1]/2,s=Math.abs(t[0]-r[0])+a[0],h=Math.abs(t[1]-r[1])+a[1],p=document.createElement("div");$(p).css({position:"absolute",width:s+"px",height:h+"px",left:i+"px",top:o+"px",transformOrigin:t[0]+"px "+t[1]+"px"});var u=Raphael(p,s,h),c="M"+t[0]+" "+t[1]+" L"+r[0]+" "+r[1],f=u.path(c);return f.graphiePath=[t,r],{wrapper:p,visibleShape:f}},sinusoid:function(t,r,e,a){return i.path(v(t,r,e,a))},grid:function(t,r){for(var e=o.step||[1,1],a=i.set(),n=e[0]*Math.ceil(t[0]/e[0]);n<=t[1];n+=e[0])a.push(this.line([n,r[0]],[n,r[1]]));for(var s=e[1]*Math.ceil(r[0]/e[1]);s<=r[1];s+=e[1])a.push(this.line([t[0],s],[t[1],s]));return a},label:function(r,e,a,n){n="undefined"==typeof n||n;var i=$("<span>").addClass("graphie-label"),s=o["label-distance"];i.css($.extend({},o,{position:"absolute",padding:(null!=s?s:7)+"px"})).data("labelDirection",a).appendTo(t),i.setPosition=function(t){var r=l(t);i.css({left:r[0],top:r[1]})},i.setPosition(r);var h=i[0];return i.processMath=function(t,r){KhanUtil.processMath(h,t,r,function(){var t=h.scrollWidth,r=h.scrollHeight;u(h,[t,r])})},i.processText=function(t){i.html(t);var r=h.scrollWidth,e=h.scrollHeight;u(h,[r,e])},n?i.processMath(e,!1):i.processText(e),i},plotParametric:function(t,r,e,a){a=a||function(t){return[t,0]},o.strokeLinejoin||(o.strokeLinejoin="round"),o.strokeLinecap||(o.strokeLinecap="round");var s=r[0],l=r[1],h=(l-s)/(o["plot-points"]||800);0===h&&(h=1);for(var p=i.set(),u=[],c=KhanUtil.coordDiff(t(s),a(s)),f=s,v=s;l>=v;v+=h){var d=t(v),g=a(v),b=KhanUtil.coordDiff(d,g);if(b[1]<0!=c[1]<0&&Math.abs(b[1]-c[1])>2*n||Math.abs(b[1])>1e7||isNaN(b[1])){if(e){u.push(d);for(var m=v-h;m>=f;m-=h)u.push(a(m));f=v}p.push(this.path(u)),u=[],e&&u.push(d)}else u.push(d);c=b}if(e)for(var m=l-h;m>=f;m-=h)u.push(a(m));return p.push(this.path(u)),p},plotPolar:function(t,r){var e=r[0],n=r[1];return o["plot-points"]||(o["plot-points"]=2*(n-e)*a),this.plotParametric(function(r){return polar(t(r),180*r/Math.PI)},r)},plot:function(t,r,e,n,i){var s=r[0],l=r[1];if(o["plot-points"]||(o["plot-points"]=2*(l-s)*a),e){if(i)throw new Error("Can't shade area between functions with swapped axes.");return this.plotParametric(function(r){return[t(r),r]},r,n)}if(i){if(n)return this.plotParametric(function(r){return[r,t(r)]},r,n,function(t){return[t,i(t)]});throw new Error("fn2 should only be set when 'shade' is True.")}return this.plotParametric(function(r){return[r,t(r)]},r,n)},plotPiecewise:function(t,r){var e=i.set(),a=this;return _.times(t.length,function(n){var i=t[n],o=r[n],s=a.plotParametric(function(t){return[t,i(t)]},o);_.each(s,function(t){e.push(t)})}),e},plotEndpointCircles:function(t){var r=i.set(),e=this;return _.each(t,function(t,a){r.push(e.circle(t,.15))}),r},plotAsymptotes:function(t,r){for(var e=r[0],a=r[1],s=(a-e)/(o["plot-points"]||800),l=i.set(),h=t(e),p=e;a>=p;p+=s){var u=t(p);0>u!=0>h&&Math.abs(u-h)>2*n&&l.push(this.line([p,n],[p,-n])),h=u}return l}},m=new Graphie;return _.extend(m,{raphael:i,init:function(o){var s=o.scale||[40,40];if(s="number"==typeof s?[s,s]:s,a=s[0],n=s[1],null==o.range)return Khan.error("range should be specified in graph init");r=o.range[0],e=o.range[1];var l=(r[1]-r[0])*a,h=(e[1]-e[0])*n;return i.setSize(l,h),$(t).css({width:l,height:h}),this.range=o.range,this.scale=s,this.dimensions=[l,h],this.xpixels=l,this.ypixels=h,this},setInterval:function(){var t=Function.prototype.apply.call(window.setInterval,window,arguments);return intervalIDs.push(t),t},style:function(t,r){var e=d(t);if("function"==typeof r){var a=o;o=$.extend({},o,e);var n=r.call(m);return o=a,n}$.extend(o,e)},scalePoint:l,scaleVector:s,unscalePoint:h,unscaleVector:p,svgPath:c,svgParabolaPath:f,svgSinusoidPath:v}),$.each(b,function(t){m[t]=function(){var r,e=arguments[arguments.length-1],a=o;if("object"!=typeof e||_.isArray(e))o=$.extend({},o),r=b[t].apply(b,arguments);else{o=$.extend({},o,d(e));var n=[].slice.call(arguments,0,arguments.length-1);r=b[t].apply(b,n)}var i=r.constructor.prototype;return i===Raphael.el||i===Raphael.st?(r.attr(o),o.arrows&&(r=g(r))):r instanceof $&&r.css(o),o=a,r}}),m.graphInit=function(t){t=t||{},$.each(t,function(r,e){r.match(/.*Opacity$/)||"range"===r||"number"!=typeof e||(t[r]=[e,e]),"range"!==r&&"gridRange"!==r||(e.constructor===Array?e[0].constructor!==Array&&(t[r]=[[-e[0],e[0]],[-e[1],e[1]]]):"number"==typeof e&&(t[r]=[[-e,e],[-e,e]]))});var r=t.range||[[-10,10],[-10,10]],e=t.gridRange||t.range,a=t.scale||[20,20],n=null!=t.grid?t.grid:!0,i=t.gridOpacity||.1,o=t.gridStep||[1,1],s=null!=t.axes?t.axes:!0,l=t.axisArrows||"",h=t.axisOpacity||1,p=t.axisCenter||[Math.min(Math.max(r[0][0],0),r[0][1]),Math.min(Math.max(r[1][0],0),r[1][1])],u=null!=t.axisLabels?t.axisLabels:!1,c=null!=t.ticks?t.ticks:!0,f=t.tickStep||[2,2],v=t.tickLen||[5,5],d=t.tickOpacity||1,g=t.labels||t.labelStep||!1,b=t.labelStep||[1,1],m=t.labelOpacity||1,y=t.unityLabels||!1,x=t.labelFormat||function(t){return t},M=t.xLabelFormat||x,w=t.yLabelFormat||x,k=null!=t.smartLabelPositioning?t.smartLabelPositioning:!0,P=[[r[0][0]-(r[0][0]>0?1:0),r[0][1]+(r[0][1]<0?1:0)],[r[1][0]-(r[1][0]>0?1:0),r[1][1]+(r[1][1]<0?1:0)]];if(_.isArray(y)||(y=[y,y]),k){var L=function(t){return function(r){return(t(r)+"").replace(/-(\d)/g,"\\llap{-}$1")}};M=L(M),w=L(w)}this.init({range:P,scale:a}),n&&this.grid(e[0],e[1],{stroke:"#000000",opacity:i,step:o}),s&&("<->"===l||l===!0?this.style({stroke:"#000000",opacity:h,strokeWidth:2,arrows:"->"},function(){r[1][0]<0&&r[1][1]>0&&(this.path([p,[e[0][0],p[1]]]),this.path([p,[e[0][1],p[1]]])),r[0][0]<0&&r[0][1]>0&&(this.path([p,[p[0],e[1][0]]]),this.path([p,[p[0],e[1][1]]]))}):"->"!==l&&""!==l||this.style({stroke:"#000000",opacity:h,strokeWidth:2,arrows:l},function(){this.path([[e[0][0],p[1]],[e[0][1],p[1]]]),this.path([[p[0],e[1][0]],[p[0],e[1][1]]])}),u&&2===u.length&&(this.label([e[0][1],p[1]],u[0],"right"),this.label([p[0],e[1][1]],u[1],"above"))),c&&this.style({stroke:"#000000",opacity:d,strokeWidth:1},function(){var t=o[0]*f[0],n=v[0]/a[1],i=e[0][0],s=e[0][1];if(r[1][0]<0&&r[1][1]>0){for(var h=t+p[0];s>=h;h+=t)(s>h||!l)&&this.line([h,-n+p[1]],[h,n+p[1]]);for(var h=-t+p[0];h>=i;h-=t)(h>i||!l)&&this.line([h,-n+p[1]],[h,n+p[1]])}if(t=o[1]*f[1],n=v[1]/a[0],i=e[1][0],s=e[1][1],r[0][0]<0&&r[0][1]>0){for(var u=t+p[1];s>=u;u+=t)(s>u||!l)&&this.line([-n+p[0],u],[n+p[0],u]);for(var u=-t+p[1];u>=i;u-=t)(u>i||!l)&&this.line([-n+p[0],u],[n+p[0],u])}}),g&&this.style({stroke:"#000000",opacity:m},function(){for(var t=o[0]*f[0]*b[0],r=e[0][0],a=e[0][1],n=p[0]<0?"above":"below",i=p[0]<0?"right":"left",s=0===p[0]&&0!==p[1],h=0!==p[0]&&0===p[1],u=0!==p[0]||0!==p[1],c=y[0]||u,v=y[1]||u,d=(s?0:t)+p[0];a>=d;d+=t)(a>d||!l)&&this.label([d,p[1]],M(d),n);for(var d=-t*(c?1:2)+p[0];d>=r;d-=t)(d>r||!l)&&this.label([d,p[1]],M(d),n);t=o[1]*f[1]*b[1],r=e[1][0],a=e[1][1];for(var g=(h?0:t)+p[1];a>=g;g+=t)(a>g||!l)&&this.label([p[0],g],w(g),i);for(var g=-t*(v?1:2)+p[1];g>=r;g-=t)(g>r||!l)&&this.label([p[0],g],w(g),i)})},m},$.fn.graphie=function(t){return null==Khan.query.nographie?this.find(".graphie, script[type='text/graphie']").addBack().filter(".graphie, script[type='text/graphie']").each(function(){var r,e=$(this).text();if(null==$(this).data("graphie")){if($(this).empty(),$(this).data("update")){var a=$(this).data("update");$(this).remove();var n=$("#problemarea").add(t);r=n.find("#"+a+".graphie").data("graphie")}else{var i=this;null!=$(this).filter("script")[0]&&(i=$("<div>").addClass("graphie").attr("id",$(this).attr("id")).insertAfter(this)[0],$(this).remove()),r=KhanUtil.createGraphie(i),$(i).data("graphie",r);var a=$(i).attr("id");a&&(KhanUtil.graphs[a]=r)}"undefined"==typeof r.graph&&(r.graph={}),e="(function() {"+e+"\n})()",KhanUtil.currentGraph=r,$.tmpl.getVAR(e,r)}}).end():void 0},$.fn.graphieCleanup=function(t){cleanupIntervals()};
},{"./kpoint.js":6,"./kvector.js":7,"./tex.js":9,"./tmpl.js":10}],3:[function(require,module,exports){
function sum(e){return _.reduce(e,function(e,t){return e+t},0)}function clockwise(e){var t=_.zip(e,e.slice(1).concat(e.slice(0,1))),o=_.map(t,function(e){var t=e[0],o=e[1];return(o[0]-t[0])*(o[1]+t[1])});return sum(o)>0}function addPoints(){var e=_.toArray(arguments),t=_.zip.apply(_,e);return _.map(t,sum)}function reverseVector(e){return _.map(e,function(e){return-1*e})}function scaledDistanceFromAngle(e){var t=70.2941120352484,o=11.374597405497571,n=-.037587715462826674;return(t-o)*Math.exp(n*e)+o}function scaledPolarRad(e,t){return[e*Math.cos(t),e*Math.sin(t)*-1]}function scaledPolarDeg(e,t){var o=t*Math.PI/180;return scaledPolarRad(e,o)}function Protractor(e,t){this.set=e.raphael.set(),this.cx=t[0],this.cy=t[1];var o=this,n=e.unscaleVector(180.5)[0],i=e.scalePoint([this.cx-n,this.cy+n-e.unscaleVector(10.5)[1]]);this.set.push(e.mouselayer.image("https://ka-perseus-graphie.s3.amazonaws.com/e9d032f2ab8b95979f674fbfa67056442ba1ff6a.png",i[0],i[1],360,180));var a=function(o,i){var a=e.scaleVector(n);a[0]-=16,a[1]-=16;var r=e.scalePoint(t),s=Math.sin((o+90)*Math.PI/180)*(a[0]+i)+r[0],l=Math.cos((o+90)*Math.PI/180)*(a[1]+i)+r[1];return s+","+l},r=e.raphael.path(" M"+a(180,6)+" L"+a(180,2)+" L"+a(183,10)+" L"+a(180,18)+" L"+a(180,14)+" A"+(e.scaleVector(n)[0]+10)+","+(e.scaleVector(n)[1]+10)+",0,0,1,"+a(170,14)+" L"+a(170,18)+" L"+a(167,10)+" L"+a(170,2)+" L"+a(170,6)+" A"+(e.scaleVector(n)[0]+10)+","+(e.scaleVector(n)[1]+10)+",0,0,0,"+a(180,6)+" Z").attr({stroke:null,fill:KhanUtil.INTERACTIVE});this.set.push(r),this.centerPoint=e.addMovablePoint({coord:t,visible:!1}),this.rotateHandle=e.addMovablePoint({coord:[Math.sin(275*Math.PI/180)*(n+.5)+this.cx,Math.cos(275*Math.PI/180)*(n+.5)+this.cy],onMove:function(e,t){var n=180*Math.atan2(o.centerPoint.coord[1]-t,o.centerPoint.coord[0]-e)/Math.PI;o.rotate(-n-5,!0)}}),this.rotateHandle.constraints.fixedDistance.dist=n+.5,this.rotateHandle.constraints.fixedDistance.point=this.centerPoint,this.rotateHandle.visibleShape.remove(),this.rotateHandle.mouseTarget.attr({scale:2});var s=!1,l=!1,c=function(){return l||s},d=this,h=$(d.rotateHandle.mouseTarget.getMouseTarget());h.bind("vmousedown",function(e){s=!0,r.animate({scale:1.5,fill:KhanUtil.INTERACTING},50),$(document).bind("vmouseup.rotateHandle",function(e){s=!1,c()||r.animate({scale:1,fill:KhanUtil.INTERACTIVE},50),$(document).unbind("vmouseup.rotateHandle")})}),h.bind("vmouseover",function(e){l=!0,r.animate({scale:1.5,fill:KhanUtil.INTERACTING},50)}),h.bind("vmouseout",function(e){l=!1,c()||r.animate({scale:1,fill:KhanUtil.INTERACTIVE},50)});var u=$.map(this.set,function(e){return e.node});return this.makeTranslatable=function(){$(u).css("cursor","move"),$(u).bind("vmousedown",function(t){t.preventDefault();var n=t.pageX-$(e.raphael.canvas.parentNode).offset().left,i=t.pageY-$(e.raphael.canvas.parentNode).offset().top;$(document).bind("vmousemove.protractor",function(t){var a=t.pageX-$(e.raphael.canvas.parentNode).offset().left,r=t.pageY-$(e.raphael.canvas.parentNode).offset().top;a=Math.max(10,Math.min(e.xpixels-10,a)),r=Math.max(10,Math.min(e.ypixels-10,r));var s=a-n,l=r-i;$.each(o.set.items,function(){this.translate(s,l)}),o.centerPoint.setCoord([o.centerPoint.coord[0]+s/e.scale[0],o.centerPoint.coord[1]-l/e.scale[1]]),o.rotateHandle.setCoord([o.rotateHandle.coord[0]+s/e.scale[0],o.rotateHandle.coord[1]-l/e.scale[1]]),n=a,i=r}),$(document).one("vmouseup",function(e){$(document).unbind("vmousemove.protractor")})})},this.rotation=0,this.rotate=function(t,o){var n=e.scalePoint(this.centerPoint.coord);return o&&(this.rotation=0),this.set.rotate(this.rotation+t,n[0],n[1]),this.rotation=this.rotation+t,this},this.moveTo=function(t,n){var i=e.scalePoint(o.centerPoint.coord),a=e.scalePoint([t,n]),r=2*KhanUtil.getDistance(i,a);$({x:i[0],y:i[1]}).animate({x:a[0],y:a[1]},{duration:r,step:function(t,n){var i=0,a=0;"x"===n.prop?i=t-e.scalePoint(o.centerPoint.coord)[0]:"y"===n.prop&&(a=t-e.scalePoint(o.centerPoint.coord)[1]),$.each(o.set.items,function(){this.translate(i,a)}),o.centerPoint.setCoord([o.centerPoint.coord[0]+i/e.scale[0],o.centerPoint.coord[1]-a/e.scale[1]]),o.rotateHandle.setCoord([o.rotateHandle.coord[0]+i/e.scale[0],o.rotateHandle.coord[1]-a/e.scale[1]])}})},this.rotateTo=function(e){Math.abs(this.rotation-e)>180&&(this.rotation+=360);var t=5*Math.abs(this.rotation-e);$({0:this.rotation}).animate({0:e},{duration:t,step:function(e,t){o.rotate(e,!0),o.rotateHandle.setCoord([Math.sin((e+275)*Math.PI/180)*(n+.5)+o.centerPoint.coord[0],Math.cos((e+275)*Math.PI/180)*(n+.5)+o.centerPoint.coord[1]])}})},this.remove=function(){this.set.remove()},this.makeTranslatable(),this}function Ruler(e,t){function o(e){for(var t=0;t<g.length;t++){var o=g[t];if(e%o===0)return n[o]}}_.defaults(t,{center:[0,0],pixelsPerUnit:40,ticksPerUnit:10,units:10,label:"",style:{fill:null,stroke:KhanUtil.GRAY}});var n,i=_.extend({},t.style,{strokeWidth:1}),a=_.extend({},t.style,{strokeWidth:2}),r=t.units*t.pixelsPerUnit,s=50,l=e.unscalePoint(kvector.subtract(e.scalePoint(t.center),kvector.scale([r,-s],.5))),c=t.pixelsPerUnit/e.scale[0],d=s/e.scale[0],h=kvector.add(l,[t.units*c,d]),u=1;if(10===t.ticksPerUnit)n={10:u,5:.55*u,1:.35*u};else{var p=[1,.6,.45,.3];n={};for(var v=t.ticksPerUnit;v>=1;v/=2)n[v]=u*(p.shift()||.2)}var g=_.keys(n).sort(function(e,t){return t-e}),f=l[0],m=l[1],y=h[0],b=h[1],x=t.units*t.ticksPerUnit+1,k=e.raphael.set(),M=1/e.scale[0];k.push(e.line([f-M,m],[y+M,m],a)),k.push(e.line([f-M,b],[y+M,b],a)),_.times(x,function(n){var r=n/t.ticksPerUnit,s=f+r*c,l=o(n)*d,h=0===n||n===x-1?a:i;if(k.push(e.line([s,m],[s,m+l],h)),r%1===0){var u,p,v=e.scalePoint([s,b]);0===r?(u=t.label,p={mm:13,cm:11,m:8,km:11,"in":8,ft:8,yd:10,mi:10}[u]||3*u.toString().length):(u=r,p=-3*(r.toString().length+1));var g=e.raphael.text(v[0]+p,v[1]+10,u);g.attr({"font-family":"KaTeX_Main","font-size":"12px",color:"#444"}),k.push(g)}});var A=e.mouselayer.path(KhanUtil.svgPath([l,[f,b],h,[y,m],!0]));A.attr({fill:"#000",opacity:0,stroke:"#000","stroke-width":2}),k.push(A);var S=$.map(k,function(e){return e.node});$(S).css("cursor","move"),$(S).bind("vmousedown",function(t){t.preventDefault();var o=t.pageX-$(e.raphael.canvas.parentNode).offset().left,n=t.pageY-$(e.raphael.canvas.parentNode).offset().top;$(document).bind("vmousemove.ruler",function(t){var i=t.pageX-$(e.raphael.canvas.parentNode).offset().left,a=t.pageY-$(e.raphael.canvas.parentNode).offset().top;i=Math.max(10,Math.min(e.xpixels-10,i)),a=Math.max(10,Math.min(e.ypixels-10,a));var r=i-o,s=a-n;k.translate(r,s),T.setCoord([T.coord[0]+r/e.scale[0],T.coord[1]-s/e.scale[1]]),P.setCoord([P.coord[0]+r/e.scale[0],P.coord[1]-s/e.scale[1]]),o=i,n=a}),$(document).one("vmouseup",function(e){$(document).unbind("vmousemove.ruler")})});var T=e.addMovablePoint({coord:l,normalStyle:{fill:KhanUtil.INTERACTIVE,"fill-opacity":0,stroke:KhanUtil.INTERACTIVE},highlightStyle:{fill:KhanUtil.INTERACTING,"fill-opacity":.1,stroke:KhanUtil.INTERACTING},pointSize:6,onMove:function(t,o){var n=P.coord[1]-o,i=P.coord[0]-t,a=180*Math.atan2(n,i)/Math.PI,r=kvector.scale(kvector.add([t,o],P.coord),.5),s=e.scalePoint(r),l=kvector.scale(kvector.add(T.coord,P.coord),.5),c=e.scalePoint(l),d=kvector.subtract(s,c);k.rotate(-a,c[0],c[1]),k.translate(d[0],d[1])}}),P=e.addMovablePoint({coord:[y,m],normalStyle:{fill:KhanUtil.INTERACTIVE,"fill-opacity":0,stroke:KhanUtil.INTERACTIVE},highlightStyle:{fill:KhanUtil.INTERACTING,"fill-opacity":.1,stroke:KhanUtil.INTERACTING},pointSize:6,onMove:function(t,o){var n=o-T.coord[1],i=t-T.coord[0],a=180*Math.atan2(n,i)/Math.PI,r=kvector.scale(kvector.add([t,o],T.coord),.5),s=e.scalePoint(r),l=kvector.scale(kvector.add(T.coord,P.coord),.5),c=e.scalePoint(l),d=kvector.subtract(s,c);k.rotate(-a,c[0],c[1]),k.translate(d[0],d[1])}});return T.constraints.fixedDistance.dist=r/e.scale[0],T.constraints.fixedDistance.point=P,P.constraints.fixedDistance.dist=r/e.scale[0],P.constraints.fixedDistance.point=T,this.remove=function(){k.remove(),T.remove(),P.remove()},this}function MovableAngle(e,t){if(this.graphie=e,_.extend(this,t),_.defaults(this,{normalStyle:{stroke:KhanUtil.INTERACTIVE,"stroke-width":2,fill:KhanUtil.INTERACTIVE},highlightStyle:{stroke:KhanUtil.INTERACTING,"stroke-width":2,fill:KhanUtil.INTERACTING},labelStyle:{stroke:KhanUtil.DYNAMIC,"stroke-width":1,color:KhanUtil.DYNAMIC},angleStyle:{stroke:KhanUtil.DYNAMIC,"stroke-width":1,color:KhanUtil.DYNAMIC},allowReflex:!0}),!this.points||3!==this.points.length)throw new Error("MovableAngle requires 3 points");this.points=_.map(t.points,function(t){return _.isArray(t)?e.addMovablePoint({coord:t,visible:!1,constraints:{fixed:!0},normalStyle:this.normalStyle}):t},this),this.coords=_.pluck(this.points,"coord"),null==this.reflex&&(this.allowReflex?this.reflex=this._getClockwiseAngle(this.coords)>180:this.reflex=!1),this.rays=_.map([0,2],function(t){return e.addMovableLineSegment({pointA:this.points[1],pointZ:this.points[t],fixed:!0,extendRay:!0})},this),this.temp=[],this.labeledAngle=e.label([0,0],"","center",this.labelStyle),this.fixed||(this.addMoveHandlers(),this.addHighlightHandlers()),this.update()}require("../third_party/jquery.mobile.vmouse.js"),require("./graphie.js");var kvector=require("./kvector.js"),kpoint=require("./kpoint.js"),kline=require("./kline.js"),WrappedEllipse=require("./wrapped-ellipse.js"),WrappedLine=require("./wrapped-line.js"),WrappedPath=require("./wrapped-path.js");$.extend(KhanUtil,{FILL_OPACITY:.3,dragging:!1,createSorter:function(){var e,t={};return t.hasAttempted=!1,t.init=function(o){e=$("[id="+o+"]").last();var n=e.wrap("<div>").parent(),i=$("<li>");i.addClass("placeholder"),n.addClass("sortable ui-helper-clearfix"),e.find("li").each(function(o,n){$(n).bind("vmousedown",function(o){if("vmousedown"===o.type&&(1===o.which||0===o.which)){o.preventDefault(),$(n).addClass("dragging");var a=$(this).index();i.insertAfter(n),i.width($(n).width()),$(this).css("z-index",100);var r=$(this).offset(),s={left:o.pageX-r.left-3,top:o.pageY-r.top-3};$(n).css({position:"absolute"}),$(n).offset({left:r.left,top:r.top}),$(document).bind("vmousemove.tile vmouseup.tile",function(o){if(o.preventDefault(),"vmousemove"===o.type){t.hasAttempted=!0,$(n).offset({left:o.pageX-s.left,top:o.pageY-s.top});var r=e.offset().left,l=$(n).offset().left-r,c=0,d=0;if(e.find("li").each(function(){this!==i[0]&&this!==n&&(l>d+$(this).outerWidth(!0)/2&&(c+=1),d+=$(this).outerWidth(!0))}),c!==a)if(a=c,0===c)i.prependTo(e),$(n).prependTo(e);else{i.detach(),$(n).detach();var h=e.find("li")[c-1];i.insertAfter(h),$(n).insertAfter(h)}}else if("vmouseup"===o.type){$(document).unbind(".tile");var u=$(n).offset();$(u).animate(i.offset(),{duration:150,step:function(e,t){u[t.prop]=e,$(n).offset(u)},complete:function(){$(n).css("z-index",0),i.detach(),$(n).css({position:"static"}),$(n).removeClass("dragging")}})}})}})})},t.getContent=function(){var t=[];return e.find("li").each(function(e,o){t.push($.trim($(o).find(".sort-key").text()))}),t},t.setContent=function(t){var o=[];$.each(t,function(t,n){var i=e.find("li .sort-key").filter(function(){return $(this).text()===n}).closest("li").get(0);$(i).detach(),o.push(i)}),e.append(o)},t},bogusShape:{animate:function(){},attr:function(){},remove:function(){}}}),$.extend(KhanUtil.Graphie.prototype,{initAutoscaledGraph:function(e,t){var o=this;t=$.extend({xpixels:500,ypixels:500,xdivisions:20,ydivisions:20,labels:!0,unityLabels:!0,range:void 0===e?[[-10,10],[-10,10]]:e},t),t.scale=[t.xpixels/(t.range[0][1]-t.range[0][0]),t.ypixels/(t.range[1][1]-t.range[1][0])],t.gridStep=[(t.range[0][1]-t.range[0][0])/t.xdivisions,(t.range[1][1]-t.range[1][0])/t.ydivisions],o.xpixels=t.xpixels,o.ypixels=t.ypixels,o.range=t.range,o.scale=t.scale,o.graphInit(t)},addMouseLayer:function(e){var t=this;e=_.extend({allowScratchpad:!1},e);var o=2;if(t.mouselayer=Raphael(t.raphael.canvas.parentNode,t.xpixels,t.ypixels),$(t.mouselayer.canvas).css("z-index",o),e.onClick||e.onMouseDown||e.onMouseMove||e.onMouseOver||e.onMouseOut){var n=t.mouselayer.rect(0,0,t.xpixels,t.ypixels).attr({fill:"#000",opacity:0}),i=!1;$(t.mouselayer.canvas).on("vmousedown",function(o){o.target===n[0]&&(e.onMouseDown&&e.onMouseDown(t.getMouseCoord(o)),i=!0,e.onMouseMove&&$(document).bind("vmousemove.mouseLayer",function(o){i&&(o.preventDefault(),e.onMouseMove(t.getMouseCoord(o)))}),$(document).bind("vmouseup.mouseLayer",function(o){$(document).unbind(".mouseLayer"),i&&e.onClick&&e.onClick(t.getMouseCoord(o)),i=!1}))}),e.onMouseOver&&$(t.mouselayer.canvas).on("vmouseover",function(o){e.onMouseOver(t.getMouseCoord(o))}),e.onMouseOut&&$(t.mouselayer.canvas).on("vmouseout",function(o){e.onMouseOut(t.getMouseCoord(o))})}e.allowScratchpad||Khan.scratchpad.disable(),t._mouselayerWrapper=document.createElement("div"),$(t._mouselayerWrapper).css({position:"absolute",left:0,top:0,zIndex:o}),t._visiblelayerWrapper=document.createElement("div"),$(t._visiblelayerWrapper).css({position:"absolute",left:0,top:0});var a=t.raphael.canvas.parentNode;a.appendChild(t._visiblelayerWrapper),a.appendChild(t._mouselayerWrapper),t.addToMouseLayerWrapper=function(e){this._mouselayerWrapper.appendChild(e)},t.addToVisibleLayerWrapper=function(e){this._visiblelayerWrapper.appendChild(e)}},getMousePx:function(e){var t=this,o=e.pageX-$(t.raphael.canvas.parentNode).offset().left,n=e.pageY-$(t.raphael.canvas.parentNode).offset().top;return[o,n]},getMouseCoord:function(e){return this.unscalePoint(this.getMousePx(e))},drawArcs:function(e,t,o,n){var i=KhanUtil.findAngle(e,t),a=KhanUtil.findAngle(o,t);if(((a-i)%360+360)%360>180){var r=i;i=a,a=r}var s=.3;75>((a-i)%360+360)%360&&(s=-.6/90*(((a-i)%360+360)%360)+.8);for(var l=[],c=0;n>c;++c)l.push(this.arc(t,s+.15*c,i,a));return l},labelAngle:function(e){var t=this;_.defaults(e,{point1:[0,0],vertex:[0,0],point3:[0,0],label:null,numArcs:1,showRightAngleMarker:!0,pushOut:0,clockwise:!1,style:{}});var o,n,i=void 0===e.text?"":e.text,a=e.vertex,r=t.scalePoint(a);e.clockwise?(o=e.point1,n=e.point3):(o=e.point3,n=e.point1);var s=KhanUtil.findAngle(o,a),l=KhanUtil.findAngle(n,a),c=(l+360-s)%360,d=(s+c/2)%360,h=5*e.pushOut,u=h+scaledDistanceFromAngle(c),p=[];if(Math.abs(c-90)<1e-9&&e.showRightAngleMarker){var v=addPoints(r,scaledPolarDeg(u,s)),g=addPoints(r,scaledPolarDeg(u,l));u*=Math.SQRT2;var f=addPoints(r,scaledPolarDeg(u,d));_.each([v,g],function(o){p.push(t.scaledPath([o,f],e.style))})}else _.times(e.numArcs,function(o){p.push(t.arc(a,t.unscaleVector(u),s,l,e.style)),u+=3});if(i){var m=i.match(/\$deg(\d)?/);if(m){var y=m[1]||1;i=i.replace(m[0],KhanUtil.toFixedApprox(c,y)+"^{\\circ}")}var b=scaledPolarDeg(u+15,d),x=addPoints(r,b),k=t.unscalePoint(x);e.label?(e.label.setPosition(k),e.label.processMath(i,!0)):t.label(k,i,"center",e.style)}return p},labelSide:function(e){var t=this;_.defaults(e,{point1:[0,0],point2:[0,0],label:null,text:"",numTicks:0,numArrows:0,clockwise:!1,style:{}});var o,n;e.clockwise?(o=e.point1,n=e.point2):(o=e.point2,n=e.point1);var i=[(o[0]+n[0])/2,(o[1]+n[1])/2],a=t.scalePoint(i),r=Math.atan2(n[1]-o[1],n[0]-o[0]),s=r+Math.PI/2,l=[],c=0;if(e.numTicks){var d=e.numTicks,h=5,u=5,p=_.extend({},e.style,{strokeWidth:2});_.times(d,function(e){var o=h*(e-(d-1)/2),n=scaledPolarRad(o,r),i=scaledPolarRad(u,s),c=[addPoints(a,n,i),addPoints(a,n,reverseVector(i))];l.push(t.scaledPath(c,p))}),c+=h*(d-1)+15}if(e.numArrows){var d=e.numArrows,v=[o,n].sort(function(e,t){return e[1]===t[1]?e[0]-t[0]:e[1]-t[1]})[0],g=t.scalePoint(v),p=_.extend({},e.style,{arrows:"->",strokeWidth:2}),h=5;_.times(d,function(e){var n=c+h*e,i=scaledPolarRad(n,r);v!==o&&(i=reverseVector(i));var s=addPoints(a,i);l.push(t.scaledPath([g,s],p))})}var f=e.text;if(f){var m=f.match(/\$len(\d)?/);if(m){var y=KhanUtil.getDistance(o,n),b=m[1]||1;f=f.replace(m[0],KhanUtil.toFixedApprox(y,b))}var x=20,k=scaledPolarRad(x,s),M=addPoints(a,k),A=t.unscalePoint(M);e.label?(e.label.setPosition(A),e.label.processMath(f,!0)):t.label(A,f,"center",e.style)}return l},labelVertex:function(e){var t=this;if(_.defaults(e,{point1:null,vertex:[0,0],point3:null,label:null,text:"",clockwise:!1,style:{}}),e.text){var o,n,i=e.vertex,a=t.scalePoint(i);e.clockwise?(o=e.point1,n=e.point3):(o=e.point3,n=e.point1);var r,s=135;if(o&&n){var l=KhanUtil.findAngle(o,i),c=KhanUtil.findAngle(n,i);s=(c+360-l)%360,r=(l+s/2+180)%360}else if(o){var d=KhanUtil.findAngle(i,o);r=d+90}else if(n){var d=KhanUtil.findAngle(n,i);r=d+90}else r=135;var h=10+scaledDistanceFromAngle(360-s),u=scaledPolarDeg(h,r),p=addPoints(a,u),v=t.unscalePoint(p);e.label?(e.label.setPosition(v),e.label.processMath(e.text,!0)):t.label(v,e.text,"center",e.style)}},addMovablePoint:function(e){var t=$.extend(!0,{graph:this,coord:[0,0],snapX:0,snapY:0,pointSize:4,highlight:!1,dragging:!1,visible:!0,bounded:!0,constraints:{fixed:!1,constrainX:!1,constrainY:!1,fixedAngle:{},fixedDistance:{}},lineStarts:[],lineEnds:[],polygonVertices:[],normalStyle:{},highlightStyle:{fill:KhanUtil.INTERACTING,stroke:KhanUtil.INTERACTING},labelStyle:{color:KhanUtil.INTERACTIVE},vertexLabel:"",mouseTarget:null},e),o=t.constraints.fixed?KhanUtil.DYNAMIC:KhanUtil.INTERACTIVE;t.normalStyle=_.extend({},{fill:o,stroke:o},e.normalStyle),void 0!==e.coordX&&(t.coord[0]=e.coordX),void 0!==e.coordY&&(t.coord[1]=e.coordY);var n=t.graph,i=function(e){t.visible&&t.bounded&&!t.constraints.fixed&&(e=n.constrainToBounds(e,10));var o=e[0],i=e[1];if(0!==t.snapX&&(o=Math.round(o/t.snapX)*t.snapX),0!==t.snapY&&(i=Math.round(i/t.snapY)*t.snapY),t.constraints.fixedDistance.snapPoints){var a=n.scalePoint(e),r=a[0],s=a[1],l=2*Math.PI/t.constraints.fixedDistance.snapPoints,c=t.constraints.fixedDistance.dist,d=t.constraints.fixedDistance.point,h=(d[0]-n.range[0][0])*n.scale[0],u=(-d[1]+n.range[1][1])*n.scale[1],p=r-h,v=-s+u,g=Math.atan(v/p),f=0>p;f&&(g+=Math.PI),g=Math.round(g/l)*l,p=c*Math.cos(g),v=c*Math.sin(g),r=p+h,s=-v+u,o=KhanUtil.roundTo(5,r/n.scale[0]+n.range[0][0]),i=KhanUtil.roundTo(5,n.range[1][1]-s/n.scale[1])}var m=t.applyConstraint([o,i]);return m};t.applyConstraint=function(e,o,n){var i=e.slice(),a={};if(n?$.extend(a,{fixed:!1,constrainX:!1,constrainY:!1,fixedAngle:{},fixedDistance:{}},o):$.extend(a,this.constraints,o),a.constrainX)i=[this.coord[0],e[1]];else if(a.constrainY)i=[e[0],this.coord[1]];else if("number"==typeof a.fixedAngle.angle&&"number"==typeof a.fixedDistance.dist){var r=a.fixedAngle.vertex.coord||a.fixedAngle.vertex,s=a.fixedAngle.ref.coord||a.fixedAngle.ref,l=a.fixedDistance.point.coord||a.fixedDistance.point,c=(a.fixedAngle.angle+KhanUtil.findAngle(s,r))*Math.PI/180,d=a.fixedDistance.dist;i[0]=d*Math.cos(c)+l[0],i[1]=d*Math.sin(c)+l[1]}else if("number"==typeof a.fixedAngle.angle){var r=a.fixedAngle.vertex.coord||a.fixedAngle.vertex,s=a.fixedAngle.ref.coord||a.fixedAngle.ref,c=(a.fixedAngle.angle+KhanUtil.findAngle(s,r))*Math.PI/180,h=KhanUtil.findAngle(e,r)*Math.PI/180,u=KhanUtil.getDistance(e,r),d=u*Math.cos(c-h);d=1>d?1:d,i[0]=d*Math.cos(c)+r[0],i[1]=d*Math.sin(c)+r[1]}else if("number"==typeof a.fixedDistance.dist){var l=a.fixedDistance.point.coord||a.fixedDistance.point,h=KhanUtil.findAngle(e,l),d=a.fixedDistance.dist;h=h*Math.PI/180,i[0]=d*Math.cos(h)+l[0],i[1]=d*Math.sin(h)+l[1]}else a.fixed&&(i=t.coord);return i},t.coord=i(t.coord);var a=2;if(t.visible&&n.style(t.normalStyle,function(){var e=[t.pointSize/n.scale[0],t.pointSize/n.scale[1]],o={maxScale:a};t.visibleShape=new WrappedEllipse(n,t.coord,e,o),t.visibleShape.attr(_.omit(t.normalStyle,"scale")),t.visibleShape.toFront()}),t.normalStyle.scale=1,t.highlightStyle.scale=a,t.vertexLabel&&(t.labeledVertex=this.label([0,0],"","center",t.labelStyle)),t.drawLabel=function(){t.vertexLabel&&t.graph.labelVertex({vertex:t.coord,label:t.labeledVertex,text:t.vertexLabel,style:t.labelStyle})},t.drawLabel(),t.grab=function(){$(document).bind("vmousemove.point vmouseup.point",function(e){e.preventDefault(),t.dragging=!0,KhanUtil.dragging=!0;var o=n.getMouseCoord(e);o=i(o);var a,r,s=o[0],l=o[1];if("vmousemove"===e.type){var c=!0;if(_.isFunction(t.onMove)){var d=t.onMove(s,l);d===!1&&(c=!1),_.isArray(d)&&(s=d[0],l=d[1])}if(a=(s-n.range[0][0])*n.scale[0],r=(-l+n.range[1][1])*n.scale[1],c){var h=n.unscalePoint([a,r]);t.visibleShape.moveTo(h),t.mouseTarget.moveTo(h),t.coord=[s,l],t.updateLineEnds(),$(t).trigger("move")}t.drawLabel()}else if("vmouseup"===e.type){if($(document).unbind(".point"),t.dragging=!1,KhanUtil.dragging=!1,_.isFunction(t.onMoveEnd)){var d=t.onMoveEnd(s,l);if(_.isArray(d)){s=d[0],l=d[1],a=(s-n.range[0][0])*n.scale[0],r=(-l+n.range[1][1])*n.scale[1];var h=n.unscalePoint([a,r]);t.visibleShape.moveTo(h),t.mouseTarget.moveTo(h),t.coord=[s,l]}}t.highlight||(t.visibleShape.animate(t.normalStyle,50),t.onUnhighlight&&t.onUnhighlight())}})},t.visible&&!t.constraints.fixed){if(!t.mouseTarget){var r=n.unscaleVector(15),e={mouselayer:!0};t.mouseTarget=new WrappedEllipse(n,t.coord,r,e),t.mouseTarget.attr({fill:"#000",opacity:0})}var s=$(t.mouseTarget.getMouseTarget());s.css("cursor","move"),s.bind("vmousedown vmouseover vmouseout",function(e){"vmouseover"===e.type?(t.highlight=!0,KhanUtil.dragging||(t.visibleShape.animate(t.highlightStyle,50),t.onHighlight&&t.onHighlight())):"vmouseout"===e.type?(t.highlight=!1,t.dragging||KhanUtil.dragging||(t.visibleShape.animate(t.normalStyle,50),t.onUnhighlight&&t.onUnhighlight())):"vmousedown"!==e.type||1!==e.which&&0!==e.which||(e.preventDefault(),t.grab())})}return t.moveTo=function(e,o,n){var i=KhanUtil.getDistance(this.graph.scalePoint([e,o]),this.graph.scalePoint(this.coord)),a=5*i,r=n&&function(e){t.coord=e,t.updateLineEnds()};this.visibleShape.animateTo([e,o],a,r),this.mouseTarget.animateTo([e,o],a,r),this.coord=[e,o],_.isFunction(this.onMove)&&this.onMove(e,o)},t.updateLineEnds=function(){$(this.lineStarts).each(function(){this.coordA=t.coord,this.transform()}),$(this.lineEnds).each(function(){this.coordZ=t.coord,this.transform()}),$(this.polygonVertices).each(function(){this.transform()})},t.setCoord=function(e){this.visible&&(this.visibleShape.moveTo(e),null!=this.mouseTarget&&this.mouseTarget.moveTo(e)),this.coord=e.slice()},t.setCoordConstrained=function(e){this.setCoord(i(e))},t.toBack=function(){this.visible&&(null!=this.mouseTarget&&this.mouseTarget.toBack(),this.visibleShape.toBack())},t.toFront=function(){this.visible&&(null!=this.mouseTarget&&this.mouseTarget.toFront(),this.visibleShape.toFront())},t.remove=function(){this.visibleShape&&this.visibleShape.remove(),this.mouseTarget&&this.mouseTarget.remove(),this.labeledVertex&&this.labeledVertex.remove()},t},addInteractiveFn:function(e,t){var o=this;t=$.extend({graph:o,snap:0,range:[o.range[0][0],o.range[0][1]]},t);var n={highlight:!1};o.style({stroke:KhanUtil.BLUE},function(){n.visibleShape=o.plot(e,t.range,t.swapAxes)}),o.style({fill:KhanUtil.BLUE,stroke:KhanUtil.BLUE},function(){n.cursorPoint=o.ellipse([0,e(0)],[4/o.scale[0],4/o.scale[1]])}),n.cursorPoint.attr("opacity",0);for(var i=30,a=[],r=(t.range[1]-t.range[0])/100,s=function(e,n){t.swapAxes?a.push([(n-o.range[0][0])*o.scale[0],(o.range[1][1]-e)*o.scale[1]]):a.push([(e-o.range[0][0])*o.scale[0],(o.range[1][1]-n)*o.scale[1]])},l=t.range[0];l<=t.range[1];l+=r){var c=(e(l-.001)-e(l+.001))/.002,d=l,h=e(l)+i/(2*o.scale[1]);if(0!==c){var u=-1/(c*(o.scale[1]/o.scale[0]))/(o.scale[1]/o.scale[0]);0>c?(d=l-Math.cos(-Math.atan(u*(o.scale[1]/o.scale[0])))*i/(2*o.scale[0]),h=u*(l-d)+e(l)):c>0&&(d=l+Math.cos(-Math.atan(u*(o.scale[1]/o.scale[0])))*i/(2*o.scale[0]),h=u*(l-d)+e(l))}s(d,h)}for(var l=t.range[1];l>=t.range[0];l-=r){var c=(e(l-.001)-e(l+.001))/.002,d=l,h=e(l)-i/(2*o.scale[1]);if(0!==c){var u=-1/(c*(o.scale[1]/o.scale[0]))/(o.scale[1]/o.scale[0]);0>c?(d=l+Math.cos(-Math.atan(u*(o.scale[1]/o.scale[0])))*i/(2*o.scale[0]),h=u*(l-d)+e(l)):c>0&&(d=l-Math.cos(-Math.atan(u*(o.scale[1]/o.scale[0])))*i/(2*o.scale[0]),h=u*(l-d)+e(l))}s(d,h)}return n.mouseTarget=o.mouselayer.path(KhanUtil.unscaledSvgPath(a)),n.mouseTarget.attr({fill:"#000",opacity:0}),$(n.mouseTarget[0]).bind("vmouseover vmouseout vmousemove",function(i){i.preventDefault();var a=i.pageX-$(o.raphael.canvas.parentNode).offset().left,r=i.pageY-$(o.raphael.canvas.parentNode).offset().top;a=Math.max(10,Math.min(o.xpixels-10,a)),r=Math.max(10,Math.min(o.ypixels-10,r)),t.snap&&(a=Math.round(a/(o.scale[0]*t.snap))*(o.scale[0]*t.snap));var s=a/o.scale[0]+o.range[0][0],l=o.range[1][1]-r/o.scale[1],c=function(n,i){for(var a=0,r=Math.sqrt(n*n+i*i),s=t.range[0];s<t.range[1];s+=(t.range[1]-t.range[0])/o.xpixels)Math.sqrt((s-n)*(s-n)+(e(s)-i)*(e(s)-i))<r&&(a=s,r=Math.sqrt((s-n)*(s-n)+(e(s)-i)*(e(s)-i)));return a};if(t.swapAxes){var d=c(l,s);s=e(d),l=d}else{var d=c(s,l);s=d,l=e(d)}n.cursorPoint.attr("cx",(o.range[0][1]+s)*o.scale[0]),n.cursorPoint.attr("cy",(o.range[1][1]-l)*o.scale[1]),_.isFunction(n.onMove)&&n.onMove(s,l),"vmouseover"===i.type?(n.cursorPoint.animate({opacity:1},50),n.highlight=!0):"vmouseout"===i.type&&(n.highlight=!1,n.cursorPoint.animate({opacity:0},50),_.isFunction(n.onLeave)&&n.onLeave(s,l))}),n.mouseTarget.toBack(),n},addMovableLineSegment:function(e){var t=$.extend({graph:this,coordA:[0,0],coordZ:[1,1],snapX:0,snapY:0,fixed:!1,ticks:0,normalStyle:{},highlightStyle:{stroke:KhanUtil.INTERACTING,"stroke-width":6},labelStyle:{stroke:KhanUtil.INTERACTIVE,color:KhanUtil.INTERACTIVE},highlight:!1,dragging:!1,tick:[],extendLine:!1,extendRay:!1,constraints:{fixed:!1,constrainX:!1,constrainY:!1},sideLabel:"",vertexLabels:[],numArrows:0,numTicks:0,movePointsWithLine:!1},e),o=t.fixed?KhanUtil.DYNAMIC:KhanUtil.INTERACTIVE;t.normalStyle=_.extend({},{"stroke-width":2,stroke:o},e.normalStyle),t.arrowStyle=_.extend({},t.normalStyle,{color:t.normalStyle.stroke}),void 0!==e.pointA?(t.coordA=e.pointA.coord,t.pointA.lineStarts.push(t)):void 0!==e.coordA&&(t.coordA=e.coordA.slice()),void 0!==e.pointZ?(t.coordZ=e.pointZ.coord,t.pointZ.lineEnds.push(t)):void 0!==e.coordA&&(t.coordA=t.coordA.slice());var n=t.graph;n.style(t.normalStyle);for(var i=0;i<t.ticks;++i)t.tick[i]=KhanUtil.bogusShape;for(var a=KhanUtil.unscaledSvgPath([[0,0],[1,0]]),i=0;i<t.ticks;++i){var r=.5-(t.ticks-1+2*i)/n.scale[0];a+=KhanUtil.unscaledSvgPath([[r,-7],[r,7]])}var e={thickness:Math.max(t.normalStyle["stroke-width"],t.highlightStyle["stroke-width"])};if(t.visibleLine=new WrappedLine(n,[0,0],[1,0],e),t.visibleLine.attr(t.normalStyle),!t.fixed){var e={thickness:30,mouselayer:!0};t.mouseTarget=new WrappedLine(n,[0,0],[1,0],e),t.mouseTarget.attr({fill:"#000",opacity:0})}if(t.transform=function(e){e&&("object"==typeof this.pointA&&(this.coordA=this.pointA.coord),"object"==typeof this.pointZ&&(this.coordZ=this.pointZ.coord));var o=function(e){var t=e.graph.scalePoint(e.coordA),o=e.graph.scalePoint(e.coordZ);return kvector.polarDegFromCart(kvector.subtract(o,t))[1]},i=function(e,o,n){var e=t.graph,i=e.range[0][1]-e.range[0][0],a=e.range[1][1]-e.range[1][0],r=i+a,s=e.unscaleVector(kvector.cartFromPolarDeg([1,n])),l=kvector.scale(kvector.normalize(s),r),c=kvector.add(o,l),d=kvector.polarDegFromCart(s)[1],h=e.constrainToBoundsOnAngle(c,4,d*Math.PI/180);return h},a=o(this),r=this.coordA,s=this.coordZ;this.extendLine?(r=i(n,r,360-a),s=i(n,s,(540-a)%360)):this.extendRay&&(s=i(n,r,360-a));var l=[this.visibleLine];this.fixed||l.push(this.mouseTarget),_.each(l,function(e){e.moveTo(r,s)});var c=function(e,t){var o=[.75,0],n=[[-3,4],[-2.75,2.5],[0,.25],o,[0,-.25],[-2.75,-2.5],[-3,-4]],a=1.4;n=_.map(n,function(e){var t=kvector.subtract(e,o),n=kvector.scale(t,a);return kvector.add(o,n)});var r=function(e){for(var t="M"+e[0][0]+" "+e[0][1],o=1;o<e.length;o+=3)t+="C"+e[o][0]+" "+e[o][1]+" "+e[o+1][0]+" "+e[o+1][1]+" "+e[o+2][0]+" "+e[o+2][1];return t},s=_.map(n,e.unscalePoint),l={center:e.unscalePoint(o),createPath:r},c=new WrappedPath(e,s,l);return c.attr(_.extend({"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":""},t)),c.toCoordAtAngle=function(t,n){var r=e.scalePoint(i(e,t,n)),s=KhanUtil.getCanUse3dTransform();c.transform("translateX("+(r[0]+a*o[0])+"px) translateY("+(r[1]+a*o[1])+"px) "+(s?"translateZ(0) ":"")+"rotate("+(360-KhanUtil.bound(n))+"deg)")},c};null==this._arrows&&(this._arrows=[],this.extendLine?(this._arrows.push(c(n,this.normalStyle)),this._arrows.push(c(n,this.normalStyle))):this.extendRay&&this._arrows.push(c(n,this.normalStyle)));var d=[this.coordA,this.coordZ],h=[360-a,(540-a)%360];_.each(this._arrows,function(e,t){e.toCoordAtAngle(d[t],h[t])}),_.invoke(this.temp,"remove"),this.temp=[];var u=this.coordA[0]<this.coordZ[0]||this.coordA[0]===this.coordZ[0]&&this.coordA[1]>this.coordZ[1];this.sideLabel&&this.temp.push(this.graph.labelSide({point1:this.coordA,point2:this.coordZ,label:this.labeledSide,text:this.sideLabel,numArrows:this.numArrows,numTicks:this.numTicks,clockwise:u,style:this.labelStyle})),this.vertexLabels.length&&(this.graph.labelVertex({vertex:this.coordA,point3:this.coordZ,label:this.labeledVertices[0],text:this.vertexLabels[0],clockwise:u,style:this.labelStyle}),this.graph.labelVertex({point1:this.coordA,vertex:this.coordZ,label:this.labeledVertices[1],text:this.vertexLabels[1],clockwise:u,style:this.labelStyle})),this.temp=_.flatten(this.temp)},t.toBack=function(){t.fixed||t.mouseTarget.toBack(),t.visibleLine.toBack()},t.toFront=function(){t.fixed||t.mouseTarget.toFront(),t.visibleLine.toFront()},t.remove=function(){t.fixed||t.mouseTarget.remove(),t.visibleLine.remove(),t.labeledSide&&t.labeledSide.remove(),t.labeledVertices&&_.invoke(t.labeledVertices,"remove"),t._arrows&&_.invoke(t._arrows,"remove"),t.temp.length&&_.invoke(t.temp,"remove")},t.hide=function(){t.visibleLine.hide(),t.temp.length&&_.invoke(t.temp,"hide"),t._arrows&&_.invoke(t._arrows,"hide")},t.show=function(){t.visibleLine.show(),t.temp.length&&_.invoke(t.temp,"show"),t._arrows&&_.invoke(t._arrows,"show")},t.sideLabel&&(t.labeledSide=this.label([0,0],"","center",t.labelStyle)),t.vertexLabels.length&&(t.labeledVertices=_.map(t.vertexLabels,function(e){return this.label([0,0],"","center",t.labelStyle)},this)),!t.fixed&&!t.constraints.fixed){var s=$(t.mouseTarget.getMouseTarget());s.css("cursor","move"),s.bind("vmousedown vmouseover vmouseout",function(e){if("vmouseover"===e.type)KhanUtil.dragging||(t.highlight=!0,t.visibleLine.animate(t.highlightStyle,50),t.arrowStyle=_.extend({},t.arrowStyle,{color:t.highlightStyle.stroke,stroke:t.highlightStyle.stroke}),t.transform());else if("vmouseout"===e.type)t.highlight=!1,t.dragging||(t.visibleLine.animate(t.normalStyle,50),t.arrowStyle=_.extend({},t.arrowStyle,{color:t.normalStyle.stroke,stroke:t.normalStyle.stroke}),t.transform());else if("vmousedown"===e.type&&(1===e.which||0===e.which)){e.preventDefault();var o=(e.pageX-$(n.raphael.canvas.parentNode).offset().left)/n.scale[0]+n.range[0][0],i=n.range[1][1]-(e.pageY-$(n.raphael.canvas.parentNode).offset().top)/n.scale[1];t.snapX>0&&(o=Math.round(o/t.snapX)*t.snapX),t.snapY>0&&(i=Math.round(i/t.snapY)*t.snapY);var a=[t.coordA[0]-o,t.coordA[1]-i],r=[t.coordZ[0]-o,t.coordZ[1]-i],s=-Math.min(n.scaleVector(a)[0],n.scaleVector(r)[0]),l=Math.max(n.scaleVector(a)[0],n.scaleVector(r)[0]),c=Math.max(n.scaleVector(a)[1],n.scaleVector(r)[1]),d=-Math.min(n.scaleVector(a)[1],n.scaleVector(r)[1]);$(document).bind("vmousemove.lineSegment vmouseup.lineSegment",function(e){e.preventDefault(),t.dragging=!0,KhanUtil.dragging=!0;var o=e.pageX-$(n.raphael.canvas.parentNode).offset().left,i=e.pageY-$(n.raphael.canvas.parentNode).offset().top;o=Math.max(s+10,Math.min(n.xpixels-10-l,o)),i=Math.max(c+10,Math.min(n.ypixels-10-d,i));var h=o/n.scale[0]+n.range[0][0],u=n.range[1][1]-i/n.scale[1];if(t.snapX>0&&(h=Math.round(h/t.snapX)*t.snapX),t.snapY>0&&(u=Math.round(u/t.snapY)*t.snapY),"vmousemove"===e.type){t.constraints.constrainX&&(h=t.coordA[0]-a[0]),t.constraints.constrainY&&(u=t.coordA[1]-a[1]);var p=h+a[0]-t.coordA[0],v=u+a[1]-t.coordA[1];t.coordA=[h+a[0],u+a[1]],t.coordZ=[h+r[0],u+r[1]],t.transform(),t.movePointsWithLine&&("object"==typeof t.pointA&&t.pointA.setCoord([t.pointA.coord[0]+p,t.pointA.coord[1]+v]),"object"==typeof t.pointZ&&t.pointZ.setCoord([t.pointZ.coord[0]+p,t.pointZ.coord[1]+v])),
_.isFunction(t.onMove)&&t.onMove(p,v)}else"vmouseup"===e.type&&($(document).unbind(".lineSegment"),t.dragging=!1,KhanUtil.dragging=!1,t.highlight||(t.visibleLine.animate(t.normalStyle,50),t.arrowStyle=_.extend({},t.arrowStyle,{color:t.normalStyle.stroke,stroke:t.normalStyle.stroke}),t.transform()),_.isFunction(t.onMoveEnd)&&t.onMoveEnd());$(t).trigger("move")})}})}return void 0!==t.pointA&&t.pointA.toFront(),void 0!==t.pointZ&&t.pointZ.toFront(),t.transform(),t},addMovablePolygon:function(e){var t=this,o=$.extend({snapX:0,snapY:0,fixed:!1,constrainToGraph:!0,normalStyle:{},highlightStyle:{stroke:KhanUtil.INTERACTING,"stroke-width":2,fill:KhanUtil.INTERACTING,"fill-opacity":.05},pointHighlightStyle:{fill:KhanUtil.INTERACTING,stroke:KhanUtil.INTERACTING},labelStyle:{stroke:KhanUtil.DYNAMIC,"stroke-width":1,color:KhanUtil.DYNAMIC},angleLabels:[],showRightAngleMarkers:[],sideLabels:[],vertexLabels:[],numArcs:[],numArrows:[],numTicks:[],updateOnPointMove:!0,closed:!0},_.omit(e,"points")),n=o.fixed?KhanUtil.DYNAMIC:KhanUtil.INTERACTIVE;o.normalStyle=_.extend({"stroke-width":2,"fill-opacity":0,fill:n,stroke:n},e.normalStyle),o.points=e.points;var i=function(e){return!_.isArray(e)};return o.update=function(){var e=o.points.length;o.coords=_.map(o.points,function(e,t){return i(e)?e.coord:e}),o.left=_.min(_.pluck(o.coords,0)),o.right=_.max(_.pluck(o.coords,0)),o.top=_.max(_.pluck(o.coords,1)),o.bottom=_.min(_.pluck(o.coords,1));var n=_.map(o.coords,function(e){return t.scalePoint(e)});o.closed?n.push(!0):n=n.concat(_.clone(n).reverse()),o.path=KhanUtil.unscaledSvgPath(n),_.invoke(o.temp,"remove"),o.temp=[];var a=clockwise(o.coords);(o.angleLabels.length||o.showRightAngleMarkers.length)&&_.each(o.labeledAngles,function(n,i){o.temp.push(t.labelAngle({point1:o.coords[(i-1+e)%e],vertex:o.coords[i],point3:o.coords[(i+1)%e],label:n,text:o.angleLabels[i],showRightAngleMarker:o.showRightAngleMarkers[i],numArcs:o.numArcs[i],clockwise:a,style:o.labelStyle}))}),o.sideLabels.length&&_.each(o.labeledSides,function(n,i){o.temp.push(t.labelSide({point1:o.coords[i],point2:o.coords[(i+1)%e],label:n,text:o.sideLabels[i],numArrows:o.numArrows[i],numTicks:o.numTicks[i],clockwise:a,style:o.labelStyle}))}),o.vertexLabels.length&&_.each(o.labeledVertices,function(n,i){t.labelVertex({point1:o.coords[(i-1+e)%e],vertex:o.coords[i],point3:o.coords[(i+1)%e],label:n,text:o.vertexLabels[i],clockwise:a,style:o.labelStyle})}),o.temp=_.flatten(o.temp)},o.transform=function(){o.update(),o.visibleShape.attr({path:o.path}),o.fixed||o.mouseTarget.attr({path:o.path})},o.remove=function(){o.visibleShape.remove(),o.fixed||o.mouseTarget.remove(),o.labeledAngles&&_.invoke(o.labeledAngles,"remove"),o.labeledSides&&_.invoke(o.labeledSides,"remove"),o.labeledVertices&&_.invoke(o.labeledVertices,"remove"),o.temp.length&&_.invoke(o.temp,"remove")},o.toBack=function(){o.fixed||o.mouseTarget.toBack(),o.visibleShape.toBack()},o.toFront=function(){o.fixed||o.mouseTarget.toFront(),o.visibleShape.toFront()},o.updateOnPointMove&&_.each(_.filter(o.points,i),function(e){e.polygonVertices.push(o)}),o.coords=new Array(o.points.length),o.angleLabels.length&&(o.labeledAngles=_.times(Math.max(o.angleLabels.length,o.showRightAngleMarkers.length),function(){return this.label([0,0],"","center",o.labelStyle)},this)),o.sideLabels.length&&(o.labeledSides=_.map(o.sideLabels,function(e){return this.label([0,0],"","center",o.labelStyle)},this)),o.vertexLabels.length&&(o.labeledVertices=_.map(o.vertexLabels,function(e){return this.label([0,0],"","center",o.labelStyle)},this)),o.update(),o.visibleShape=t.raphael.path(o.path),o.visibleShape.attr(o.normalStyle),o.fixed||(o.mouseTarget=t.mouselayer.path(o.path),o.mouseTarget.attr({fill:"#000",opacity:0,cursor:"move"}),$(o.mouseTarget[0]).bind("vmousedown vmouseover vmouseout",function(e){if("vmouseover"===e.type)KhanUtil.dragging&&!o.dragging||(o.highlight=!0,o.visibleShape.animate(o.highlightStyle,50),_.each(_.filter(o.points,i),function(e){e.visibleShape.animate(o.pointHighlightStyle,50)}));else if("vmouseout"===e.type){if(o.highlight=!1,!o.dragging){o.visibleShape.animate(o.normalStyle,50);var n=_.filter(o.points,i);_.any(_.pluck(n,"dragging"))||_.each(n,function(e){e.visibleShape.animate(e.normalStyle,50)})}}else if("vmousedown"===e.type&&(1===e.which||0===e.which)){e.preventDefault(),_.each(_.filter(o.points,i),function(e){e.dragging=!0});var a=(e.pageX-$(t.raphael.canvas.parentNode).offset().left)/t.scale[0]+t.range[0][0],r=t.range[1][1]-(e.pageY-$(t.raphael.canvas.parentNode).offset().top)/t.scale[1];o.snapX>0&&(a=Math.round(a/o.snapX)*o.snapX),o.snapY>0&&(r=Math.round(r/o.snapY)*o.snapY);var s=a,l=r,c=o.coords.slice(),d=(a-o.left)*t.scale[0],h=(o.right-a)*t.scale[0],u=(o.top-r)*t.scale[1],p=(r-o.bottom)*t.scale[1];$(document).bind("vmousemove.polygon vmouseup.polygon",function(e){e.preventDefault(),o.dragging=!0,KhanUtil.dragging=!0;var n=e.pageX-$(t.raphael.canvas.parentNode).offset().left,v=e.pageY-$(t.raphael.canvas.parentNode).offset().top;o.constrainToGraph&&(n=Math.max(d+10,Math.min(t.xpixels-10-h,n)),v=Math.max(u+10,Math.min(t.ypixels-10-p,v)));var g=n/t.scale[0]+t.range[0][0],f=t.range[1][1]-v/t.scale[1];if(o.snapX>0&&(g=Math.round(g/o.snapX)*o.snapX),o.snapY>0&&(f=Math.round(f/o.snapY)*o.snapY),"vmousemove"===e.type){var m=g-a,y=f-r,b=!0;if(_.isFunction(o.onMove)){var x=o.onMove(m,y);x===!1?b=!1:_.isArray(x)&&(m=x[0],y=x[1],g=a+m,f=r+y)}var k=function(e){return[c[e][0]+m,c[e][1]+y]};b&&(_.each(o.points,function(e,t){i(e)?e.setCoord(k(t)):o.points[t]=k(t)}),o.transform(),$(o).trigger("move"),s=g,l=f)}else if("vmouseup"===e.type){$(document).unbind(".polygon");var M=_.filter(o.points,i);_.each(M,function(e){e.dragging=!1}),o.dragging=!1,KhanUtil.dragging=!1,o.highlight||(o.visibleShape.animate(o.normalStyle,50),_.each(M,function(e){e.visibleShape.animate(e.normalStyle,50)})),_.isFunction(o.onMoveEnd)&&o.onMoveEnd(s-a,l-r)}})}})),_.invoke(_.filter(o.points,i),"toFront"),o},constrainToBounds:function(e,t){var o=this.unscalePoint([t,this.ypixels-t]),n=this.unscalePoint([this.xpixels-t,t]),i=Math.max(o[0],Math.min(n[0],e[0])),a=Math.max(o[1],Math.min(n[1],e[1]));return[i,a]},constrainToBoundsOnAngle:function(e,t,o){var n=this.unscalePoint([t,this.ypixels-t]),i=this.unscalePoint([this.xpixels-t,t]),a=e.slice();return a[0]<n[0]?a=[n[0],a[1]+(n[0]-a[0])*Math.tan(o)]:a[0]>i[0]&&(a=[i[0],a[1]-(a[0]-i[0])*Math.tan(o)]),a[1]<n[1]?a=[a[0]+(n[1]-a[1])/Math.tan(o),n[1]]:a[1]>i[1]&&(a=[a[0]-(a[1]-i[1])/Math.tan(o),i[1]]),a},addMovableAngle:function(e){return new MovableAngle(this,e)},addArrowWidget:function(e){var t=$.extend({graph:this,direction:"up",coord:[0,0],onClick:function(){}},e),o=t.graph;return"up"===t.direction?t.visibleShape=o.path([[t.coord[0],t.coord[1]-4/o.scale[1]],[t.coord[0]-4/o.scale[0],t.coord[1]-4/o.scale[1]],[t.coord[0],t.coord[1]+4/o.scale[1]],[t.coord[0]+4/o.scale[0],t.coord[1]-4/o.scale[1]],[t.coord[0],t.coord[1]-4/o.scale[1]]],{stroke:"",fill:KhanUtil.INTERACTIVE}):"down"===t.direction&&(t.visibleShape=o.path([[t.coord[0],t.coord[1]+4/o.scale[1]],[t.coord[0]-4/o.scale[0],t.coord[1]+4/o.scale[1]],[t.coord[0],t.coord[1]-4/o.scale[1]],[t.coord[0]+4/o.scale[0],t.coord[1]+4/o.scale[1]],[t.coord[0],t.coord[1]+4/o.scale[1]]],{stroke:"",fill:KhanUtil.INTERACTIVE})),_.defer(function(){t.visibleShape.attr({stroke:"",fill:KhanUtil.INTERACTIVE})}),t.mouseTarget=o.mouselayer.circle(o.scalePoint(t.coord)[0],o.scalePoint(t.coord)[1],15),t.mouseTarget.attr({fill:"#000",opacity:0}),$(t.mouseTarget[0]).css("cursor","pointer"),$(t.mouseTarget[0]).bind("vmousedown vmouseover vmouseout",function(e){if("vmouseover"===e.type)t.visibleShape.animate({scale:2,fill:KhanUtil.INTERACTING},20);else if("vmouseout"===e.type)t.visibleShape.animate({scale:1,fill:KhanUtil.INTERACTING},20);else if("vmousedown"===e.type&&(1===e.which||0===e.which))return t.hidden||t.onClick(),!1}),t.hide=function(){t.visibleShape.hide(),t.hidden=!0,$(t.mouseTarget[0]).css("cursor","default")},t.show=function(){t.visibleShape.show(),t.hidden=!1,$(t.mouseTarget[0]).css("cursor","pointer")},t},addRectGraph:function(e){function t(e,t,o,n){a.points[o].setCoord([e,a.points[o].coord[1]]),a.points[n].setCoord([a.points[n].coord[0],t]),a.points[o].updateLineEnds(),a.points[n].updateLineEnds()}function o(e,t,o){return o?e>t:t>e}function n(e,t,n){var i=a.getXLims(),r=a.getYLims(),s=c[e],l=o(i[s[0]],t,1===s[0]),d=o(r[s[1]],n,1===s[1]);return l&&d}function i(e,t){var o=a.constraints.constrainX,n=a.getX()+e<a.constraints.xmin,i=a.getX2()+e>a.constraints.xmax,r=a.constraints.constrainY,s=a.getY()+t<a.constraints.ymin,l=a.getY2()+t>a.constraints.ymax;return e=o||n||i?0:e,t=r||s||l?0:t,[e,t]}var a=$.extend(!0,{x:0,y:0,width:1,height:1,normalStyle:{points:{stroke:KhanUtil.INTERACTIVE,fill:KhanUtil.INTERACTIVE,opacity:1},edges:{stroke:KhanUtil.INTERACTIVE,opacity:1,"stroke-width":1},area:{fill:KhanUtil.INTERACTIVE,"fill-opacity":.1,"stroke-width":0}},hoverStyle:{points:{color:KhanUtil.INTERACTING,opacity:1,width:2},edges:{stroke:KhanUtil.INTERACTING,opacity:1,"stroke-width":1},area:{fill:KhanUtil.INTERACTING,"fill-opacity":.2,"stroke-width":0}},fixed:{edges:[!1,!1,!1,!1],points:[!1,!1,!1,!1]},constraints:{constrainX:!1,constrainY:!1,xmin:null,xmax:null,ymin:null,ymax:null},snapX:0,snapY:0,onMove:function(){}},e);a=$.extend({initialized:function(){return a.points&&a.points.length},x2:function(){return this.x+this.width},y2:function(){return this.y+this.height},getX:function(){return a.initialized()?a.points[0].coord[0]:a.x},getY:function(){return a.initialized()?a.points[0].coord[1]:a.y},getX2:function(){return a.getX()+a.getWidth()},getY2:function(){return a.getY()+a.getHeight()},getXLims:function(){var e=a.getX();return[e,e+a.getWidth()]},getYLims:function(){var e=a.getY();return[e,e+a.getHeight()]},getWidth:function(){if(a.initialized()){var e=a.points[1].coord[0],t=a.points[2].coord[0];return t-e}return a.width},getHeight:function(){if(a.initialized()){var e=a.points[0].coord[1],t=a.points[1].coord[1];return t-e}return a.height},getCoord:function(){return[a.getX(),a.getY()]},getRaphaelParamsArr:function(){var e=a.getWidth(),t=a.getHeight(),o=a.getX(),n=a.getY(),i=r.scalePoint([o,n+t]),s=r.scaleVector([e,t]);return i.concat(s)},getRaphaelParams:function(){var e=a.getRaphaelParamsArr();return{x:e[0],y:e[1],width:e[2],height:e[3]}}},a);var r=this;a.fillArea=r.rect().attr(a.normalStyle.area),a.mouseTarget=r.mouselayer.rect().attr({fill:"#000",opacity:0,"fill-opacity":0}),a.render=function(){a.fillArea.attr(a.getRaphaelParams()),a.mouseTarget.attr(a.getRaphaelParams())},a.render(),a.points=[];var s=[[a.x,a.y],[a.x,a.y2()],[a.x2(),a.y2()],[a.x2(),a.y]],l=[[1,3],[0,2],[3,1],[2,0]],c=[[1,1],[1,0],[0,0],[0,1]];_.times(4,function(e){var o=l[e][0],i=l[e][1],c=s[e],d=r.addMovablePoint({graph:r,coord:c,normalStyle:a.normalStyle.points,hoverStyle:a.hoverStyle.points,snapX:a.snapX,snapY:a.snapY,visible:!a.fixed.points[e],constraints:{fixed:a.fixed.points[e]},onMove:function(r,s){return n(e,r,s)?(t(r,s,o,i),void a.render()):!1}});a.points.push(d)}),a.edges=[],a.moveEdge=function(e,t,o){var n=a.edges[o].pointA,i=a.edges[o].pointZ;n.setCoord([n.coord[0]+e,n.coord[1]+t]),i.setCoord([i.coord[0]+e,i.coord[1]+t]),n.updateLineEnds(),i.updateLineEnds()},_.times(4,function(e){var t=a.points[e],o=a.points[(e+1)%4],n=e%2,i=(e+1)%2,s=r.addMovableLineSegment({graph:r,pointA:t,pointZ:o,normalStyle:a.normalStyle.edges,hoverStyle:a.hoverStyle.edges,snapX:a.snapX,snapY:a.snapY,fixed:a.fixed.edges[e],constraints:{constrainX:n,constrainY:i},onMove:function(t,o){a.moveEdge(t,o,e),a.render()}});a.edges.push(s)});var d=[a.fillArea,a.mouseTarget];a.elems=d.concat(a.edges).concat(a.points),a.translate=function(e,t){if(!a.constraints.constrainX||!a.constraints.constrainY){var o=i(e,t);e=o[0],t=o[1],_.each(a.points,function(o,n){var i=o.coord[0]+e,a=o.coord[1]+t;o.setCoord([i,a]),o.updateLineEnds()}),a.render(),a.onMove(e,t)}},a.moveTo=function(e,t){var o=e-a.getX(),n=t-a.getY();a.translate(o,n)},a.snap=function(){var e,t;_.each(a.points,function(o,n){var i=o.coord[0],r=o.coord[1],s=i,l=r;a.snapX&&(s=KhanUtil.roundToNearest(a.snapX,i)),a.snapY&&(l=KhanUtil.roundToNearest(a.snapY,r)),e&&t||(e=s-i,t=l-r),o.setCoord([s,l]),o.updateLineEnds()}),a.render(),a.onMove(e,t)},a.toFront=function(){_.each(a.elems,function(e){e.toFront()})},a.hide=function(e){a.hidden||(e=e||100,a.fillArea.animate({"fill-opacity":0},e),$(a.mouseTarget[0]).css("display","none"),a.hidden=!0)},a.show=function(e){a.hidden&&(e=e||100,a.fillArea.animate(a.normalStyle.area,e),$(a.mouseTarget[0]).css("display","block"),a.hidden=!1)},a.enableHoverStyle=function(){a.highlight=!0,KhanUtil.dragging||a.fillArea.animate(a.hoverStyle.area,100)},a.enableNormalStyle=function(){a.highlight=!1,a.dragging||a.fillArea.animate(a.normalStyle.area,100)};var h=function(){$(a.mouseTarget[0]).css("cursor","move"),$(a.mouseTarget[0]).on("vmouseover vmouseout vmousedown",function(e){"vmouseover"===e.type?a.enableHoverStyle():"vmouseout"===e.type?a.enableNormalStyle():"vmousedown"!==e.type||1!==e.which&&0!==e.which||(e.preventDefault(),a.toFront(),a.prevCoord=r.getMouseCoord(e),a.enableHoverStyle(),$(document).on("vmousemove vmouseup",function(e){if(e.preventDefault(),a.dragging=!0,KhanUtil.dragging=!0,"vmousemove"===e.type){var t=r.getMouseCoord(e);if(a.prevCoord&&2===a.prevCoord.length){var o=KhanUtil.coordDiff(a.prevCoord,t);a.translate(o[0],o[1])}a.prevCoord=t}else if("vmouseup"===e.type){$(document).off("vmousemove vmouseup"),a.dragging=!1,KhanUtil.dragging=!1;var t=r.getMouseCoord(e);(t[0]<a.getX()||t[0]>a.getX2()||t[1]<a.getY()||t[1]>a.getY2())&&a.enableNormalStyle(),a.snap()}}))})};return h(),a},addCircleGraph:function(e){var t=this,o=$.extend({center:[0,0],radius:2,snapX:.5,snapY:.5,snapRadius:.5,minRadius:1,centerConstraints:{},centerNormalStyle:{},centerHighlightStyle:{stroke:KhanUtil.INTERACTING,fill:KhanUtil.INTERACTING},circleNormalStyle:{stroke:KhanUtil.INTERACTIVE,"fill-opacity":0},circleHighlightStyle:{stroke:KhanUtil.INTERACTING,fill:KhanUtil.INTERACTING,"fill-opacity":.05}},e),n=o.centerConstraints.fixed?KhanUtil.DYNAMIC:KhanUtil.INTERACTIVE,i=e?e.centerNormalStyle:null;return o.centerNormalStyle=_.extend({},{fill:n,stroke:n},i),o.centerPoint=t.addMovablePoint({graph:t,coord:o.center,normalStyle:o.centerNormalStyle,snapX:o.snapX,snapY:o.snapY,constraints:o.centerConstraints}),o.circ=t.circle(o.center,o.radius,o.circleNormalStyle),o.perim=t.mouselayer.circle(t.scalePoint(o.center)[0],t.scalePoint(o.center)[1],t.scaleVector(o.radius)[0]).attr({"stroke-width":20,opacity:.002}),o.centerConstraints.fixed||$(o.centerPoint.mouseTarget.getMouseTarget()).on("vmouseover vmouseout",function(e){o.centerPoint.highlight||o.centerPoint.dragging?o.circ.animate(o.circleHighlightStyle,50):o.circ.animate(o.circleNormalStyle,50)}),o.toFront=function(){o.circ.toFront(),o.perim.toFront(),o.centerPoint.visibleShape.toFront(),o.centerConstraints.fixed||o.centerPoint.mouseTarget.toFront()},o.centerPoint.onMove=function(e,n){o.toFront(),o.circ.attr({cx:t.scalePoint(e)[0],cy:t.scalePoint(n)[1]}),o.perim.attr({cx:t.scalePoint(e)[0],cy:t.scalePoint(n)[1]}),o.onMove&&o.onMove(e,n)},$(o.centerPoint).on("move",function(){o.center=this.coord,$(o).trigger("move")}),o.setCenter=function(e,t){o.centerPoint.setCoord([e,t]),o.centerPoint.onMove(e,t),o.center=[e,t]},o.setRadius=function(e){o.radius=e,o.perim.attr({r:t.scaleVector(e)[0]}),o.circ.attr({rx:t.scaleVector(e)[0],ry:t.scaleVector(e)[1]})},o.remove=function(){o.centerPoint.remove(),o.circ.remove(),o.perim.remove()},$(o.perim[0]).css("cursor","move"),$(o.perim[0]).on("vmouseover vmouseout vmousedown",function(e){if("vmouseover"===e.type)o.highlight=!0,KhanUtil.dragging||(o.circ.animate(o.circleHighlightStyle,50),o.centerPoint.visibleShape.animate(o.centerHighlightStyle,50));else if("vmouseout"===e.type)o.highlight=!1,o.dragging||o.centerPoint.dragging||(o.circ.animate(o.circleNormalStyle,50),o.centerPoint.visibleShape.animate(o.centerNormalStyle,50));else if("vmousedown"===e.type&&(1===e.which||0===e.which)){e.preventDefault(),o.toFront();var n=o.radius;$(document).on("vmousemove vmouseup",function(e){if(e.preventDefault(),o.dragging=!0,KhanUtil.dragging=!0,"vmousemove"===e.type){var i=t.constrainToBounds(t.getMouseCoord(e),10),a=KhanUtil.getDistance(o.centerPoint.coord,i);a=Math.max(o.minRadius,Math.round(a/o.snapRadius)*o.snapRadius);var r=o.radius,s=!0;if(o.onResize){var l=o.onResize(a,r);_.isNumber(l)?a=l:l===!1&&(s=!1)}s&&(o.setRadius(a),$(o).trigger("move"))}else"vmouseup"===e.type&&($(document).off("vmousemove vmouseup"),o.dragging=!1,KhanUtil.dragging=!1,o.onResizeEnd&&o.onResizeEnd(o.radius,n))})}}),o},interactiveEllipse:function(e){var t=this,o=$.extend({center:[0,0],radius:2,xRadius:2,yRadius:2,ellipseNormalStyle:{stroke:KhanUtil.BLUE,"fill-opacity":0},ellipseBoundaryHideStyle:{"fill-opacity":0,"stroke-width":0},ellipseBoundaryShowStyle:{"fill-opacity":1,fill:KhanUtil.BLUE},onMove:function(e,t){},onLeave:function(e,t){}},e);return o.circ=t.ellipse(o.center,[o.xRadius,o.yRadius],o.ellipseNormalStyle),o.perim=t.mouselayer.ellipse(t.scalePoint(o.center)[0],t.scalePoint(o.center)[1],t.scaleVector(o.xRadius)[0],t.scaleVector(o.yRadius)[0]).attr({"stroke-width":30,opacity:.002}),o.boundaryPoint=t.circle(o.center,.4,o.ellipseBoundaryHideStyle),o.remove=function(){o.circ.remove(),o.perim.remove()},o.showPoint=function(e){var n=t.constrainToBounds(t.getMouseCoord(e),10),i=o.yRadius*(o.center[0]-n[0]),a=o.xRadius*(o.center[1]-n[1]),r=Math.atan2(a,i);n[0]=o.center[0]-o.xRadius*Math.cos(r),n[1]=o.center[1]-o.yRadius*Math.sin(r);var s=t.scalePoint(n);o.boundaryPoint.attr({cx:s[0]}),o.boundaryPoint.attr({cy:s[1]}),o.boundaryPoint.animate(o.ellipseBoundaryShowStyle,50),o.onMove(n[0],n[1])},$(o.perim[0]).on("vmouseover vmouseout vmousemove",function(e){"vmouseover"===e.type?o.showPoint(e):"vmouseout"===e.type?(o.boundaryPoint.animate(o.ellipseBoundaryHideStyle,50),o.onLeave()):"vmousemove"===e.type&&o.showPoint(e)}),o},addRotateHandle:function(){var e=function(e,t,o,n,i,a,r){var s=function(n,i){var r=o+i,s=KhanUtil.kvector.cartFromPolarDeg([r,a+n]),l=KhanUtil.kvector.add(t,s),c=e.scalePoint(l);return c[0]+","+c[1]},l=e.scaleVector(o-n),c=e.scaleVector(o+n);return e.raphael.path(" M"+s(i,-n)+" L"+s(i,-3*n)+" L"+s(2*i,0)+" L"+s(i,3*n)+" L"+s(i,n)+" A"+c[0]+","+c[1]+",0,0,1,"+s(-i,n)+" L"+s(-i,3*n)+" L"+s(-2*i,0)+" L"+s(-i,-3*n)+" L"+s(-i,-n)+" A"+l[0]+","+l[1]+",0,0,0,"+s(i,-n)+" Z").attr({stroke:null,fill:r?KhanUtil.INTERACTING:KhanUtil.INTERACTIVE})};return function(t){var o=this,n=t.center,i=t.radius,a=t.lengthAngle||30,r=t.hideArrow||!1,s=t.mouseTarget,l=_.uniqueId("rotateHandle");_.isArray(n)&&(n={coord:n});var c=o.addMovablePoint({coord:KhanUtil.kpoint.addVector(n.coord,KhanUtil.kvector.cartFromPolarDeg(i,t.angleDeg||0)),constraints:{fixedDistance:{dist:i,point:n}},mouseTarget:s});n.toFront();var d,h=n.coord,u=c.coord,p=u,v=!1,g=!1,f=function(i){if(!r){var s=KhanUtil.kvector.subtract(i,n.coord),l=KhanUtil.kvector.polarDegFromCart(s),c=l[1];d&&d.remove(),d=e(o,n.coord,t.radius,v||g?t.hoverWidth/2:t.width/2,a,c,v||g)}};$(n).on("move."+l,function(){var e=KhanUtil.kvector.subtract(n.coord,h);c.setCoord(KhanUtil.kvector.add(c.coord,e)),f(c.coord),h=n.coord,c.constraints.fixedDistance.point=n,u=c.coord}),c.onMove=function(e,o){v||(p=u,v=!0);var i=[e,o];if(t.onMove){var a=KhanUtil.kvector.polarDegFromCart(KhanUtil.kvector.subtract(u,n.coord)),r=KhanUtil.kvector.polarDegFromCart(KhanUtil.kvector.subtract(i,n.coord)),s=a[1],l=r[1],c=t.onMove(l,s);null!=c&&c!==!0&&(c===!1&&(c=s),i=KhanUtil.kvector.add(n.coord,KhanUtil.kvector.cartFromPolarDeg([a[0],c])))}return f(i),u=i,i},c.onMoveEnd=function(){if(v=!1,f(c.coord),t.onMoveEnd){var e=KhanUtil.kvector.polarDegFromCart(KhanUtil.kvector.subtract(p,n.coord)),o=KhanUtil.kvector.polarDegFromCart(KhanUtil.kvector.subtract(c.coord,n.coord));t.onMoveEnd(o[1],e[1])}},c.visibleShape.remove(),s||c.mouseTarget.attr({scale:2});var m=$(c.mouseTarget.getMouseTarget());m.bind("vmouseover",function(e){g=!0,f(c.coord)}),m.bind("vmouseout",function(e){g=!1,f(c.coord)}),f(c.coord);var y=c.remove;return c.remove=function(){y.call(c),d&&d.remove(),$(n).off("move."+l)},c.update=function(){f(c.coord)},c}}(),addReflectButton:function(){var e=function(e,t,o,n,i,a,r){kpoint.equal(o[0],o[1])&&(o=[o[0],kpoint.addVector(o[0],[1,1])]);var s=kvector.normalize(kvector.subtract(o[1],o[0])),l=kvector.scale(s,n/2),c=kvector.scale(s,i),d=kvector.rotateDeg(c,90),h=kvector.rotateDeg(c,-90),u=kvector.negate(l),p=kvector.rotateDeg(l,90),v=kvector.rotateDeg(l,-90),g=kpoint.addVectors(t,d),f=kpoint.addVectors(t,h),m=kpoint.addVectors(t,d,l,p),y=kpoint.addVectors(t,d,u,p),b=kpoint.addVectors(t,h,l,v),x=kpoint.addVectors(t,h,u,v),k=e.path([g,m,y,!0],a),M=e.path([f,b,x,!0],r);return{remove:function(){k.remove(),M.remove()}}};return function(t){var o,n=this,i=t.line,a=n.addMovablePoint({constraints:t.constraints,coord:kline.midpoint([i.pointA.coord,i.pointZ.coord]),snapX:n.snap[0],snapY:n.snap[1],onMove:function(e,t){return!1},onMoveEnd:function(e,o){t.onMoveEnd&&t.onMoveEnd.call(this,e,o)}}),r=!1,s=!1,l=function(){return r},c=_.map([0,1],function(e){var o=e?t.highlightStyle:t.normalStyle;return _.map([0,1],function(e){return _.defaults({"fill-opacity":e},o)})}),d=function(e){return s&&(e=!e),c[+l()][+e]},h=function(i,a){o&&o.remove(),o=e(n,i,a,l()?1.5*t.size:t.size,l()?.125*t.size:.25,d(0),d(1))},u=function(e,t){e=e||i.pointA.coord,t=t||i.pointZ.coord;var o=kline.midpoint([e,t]);a.setCoord(o),h(o,[e,t])};$(i).on("move",_.bind(u,a,null,null));var p=$(a.mouseTarget.getMouseTarget());p.on("vclick",function(){var e=t.onClick();e!==!1&&(s=!s,h(a.coord,[i.pointA.coord,i.pointZ.coord]))}),i.pointA.toFront(),i.pointZ.toFront(),a.visibleShape.remove();var v=n.scaleVector(t.size)[0]/20;a.mouseTarget.attr({scale:1.5*v}),p.css("cursor","pointer"),p.bind("vmouseover",function(e){r=!0,h(a.coord,[i.pointA.coord,i.pointZ.coord])}),p.bind("vmouseout",function(e){r=!1,h(a.coord,[i.pointA.coord,i.pointZ.coord])});var g=a.remove;return a.remove=function(){o.remove(),g.call(a)},a.update=u,a.isFlipped=function(){return s},u(),a}}(),protractor:function(e){return new Protractor(this,e)},ruler:function(e){return new Ruler(this,e||{})},addPoints:addPoints}),_.extend(MovableAngle.prototype,{points:[],snapDegrees:0,snapOffsetDeg:0,angleLabel:"",numArcs:1,pushOut:0,fixed:!1,addMoveHandlers:function(){function e(e,o){var n=30,i=KhanUtil.getDistance(t.scalePoint(e),t.scalePoint(o));return n>i}var t=this.graphie,o=this.points;o[1].onMove=function(n,i){var a=o[1].coord,r=[n,i],s=addPoints(r,reverseVector(a)),l=!0,c={};return _.each([0,2],function(n){var i=o[n].coord,a=addPoints(i,s),d=KhanUtil.findAngle(r,a);d*=Math.PI/180,a=t.constrainToBoundsOnAngle(a,10,d),c[n]=a,e(r,a)&&(l=!1)}),l&&_.each(c,function(e,t){o[t].setCoord(e)}),l};var n=this.snapDegrees,i=this.snapOffsetDeg;_.each([0,2],function(a){o[a].onMove=function(a,r){var s=[a,r],l=o[1].coord;if(e(l,s))return!1;if(n){var c=KhanUtil.findAngle(s,l);c=Math.round((c-i)/n)*n+i;var d=KhanUtil.getDistance(s,l);return addPoints(l,t.polar(d,c))}return!0}}),$(o).on("move",function(){this.update(),$(this).trigger("move")}.bind(this))},addHighlightHandlers:function(){var e=this.points[1];e.onHighlight=function(){_.each(this.points,function(e){e.visibleShape.animate(this.highlightStyle,50)},this),_.each(this.rays,function(e){e.visibleLine.animate(this.highlightStyle,50),e.arrowStyle=_.extend({},e.arrowStyle,{color:this.highlightStyle.stroke,stroke:this.highlightStyle.stroke})},this),this.angleStyle=_.extend({},this.angleStyle,{color:this.highlightStyle.stroke,stroke:this.highlightStyle.stroke}),this.update()}.bind(this),e.onUnhighlight=function(){_.each(this.points,function(e){e.visibleShape.animate(this.normalStyle,50)},this),_.each(this.rays,function(e){e.visibleLine.animate(e.normalStyle,50),e.arrowStyle=_.extend({},e.arrowStyle,{color:e.normalStyle.stroke,stroke:e.normalStyle.stroke})},this),this.angleStyle=_.extend({},this.angleStyle,{color:KhanUtil.DYNAMIC,stroke:KhanUtil.DYNAMIC}),this.update()}.bind(this)},_getClockwiseAngle:function(e){var t=(KhanUtil.findAngle(e[2],e[0],e[1])+360)%360;return t},isReflex:function(){return this.reflex},isClockwise:function(){var e=this._getClockwiseAngle(this.coords)>180;return e===this.reflex},getClockwiseCoords:function(){return this.isClockwise()?_.clone(this.coords):_.clone(this.coords).reverse()},update:function(e){var t=this.coords;this.coords=_.pluck(this.points,"coord"),_.invoke(this.points,"updateLineEnds");var o=this._getClockwiseAngle(t),n=this._getClockwiseAngle(this.coords),i=o>180,a=n>180;this.allowReflex&&(null==e&&(e=i!==a&&Math.abs(n-o)<180),e&&(this.reflex=!this.reflex)),_.invoke(this.temp,"remove"),this.temp=this.graphie.labelAngle({point1:this.coords[0],vertex:this.coords[1],point3:this.coords[2],label:this.labeledAngle,text:this.angleLabel,numArcs:this.numArcs,pushOut:this.pushOut,clockwise:this.reflex===a,style:this.angleStyle})},remove:function(){_.invoke(this.rays,"remove"),_.invoke(this.temp,"remove"),this.labeledAngle.remove()}});
},{"../third_party/jquery.mobile.vmouse.js":16,"./graphie.js":2,"./kline.js":4,"./kpoint.js":6,"./kvector.js":7,"./wrapped-ellipse.js":13,"./wrapped-line.js":14,"./wrapped-path.js":15}],4:[function(require,module,exports){
var kpoint=require("./kpoint.js"),knumber=require("./knumber.js"),kline=KhanUtil.kline={distanceToPoint:function(n,e){return kpoint.distanceToLine(e,n)},reflectPoint:function(n,e){return kpoint.reflectOverLine(e,n)},midpoint:function(n){return[(n[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2]},equal:function(n,e,r){var t=n[0][0],i=n[0][1],u=n[1][0],o=n[1][1];return _.every(e,function(n){var e=n[0],c=n[1],a=.5*Math.abs(t*o+u*c+e*i-u*i-e*o-t*c);return knumber.equal(a,0,r)})},intersect:function(n,e,r,t,i,u,o,c){function a(n,e,r,t){return n*t-e*r}if(0===a(r,t,o,c))return 0===a(i-n,u-e,r,t);var f=a(i-n,u-e,o,c)/a(r,t,o,c),k=a(i-n,u-e,r,t)/a(r,t,o,c);return f>=0&&1>=f&&k>=0&&1>=k}};module.exports=kline;
},{"./knumber.js":5,"./kpoint.js":6}],5:[function(require,module,exports){
var DEFAULT_TOLERANCE=1e-9,EPSILON=Math.pow(2,-42),knumber=KhanUtil.knumber={DEFAULT_TOLERANCE:DEFAULT_TOLERANCE,EPSILON:EPSILON,is:function(n){return _.isNumber(n)&&!_.isNaN(n)},equal:function(n,r,u){return null==n||null==r?n===r:(null==u&&(u=DEFAULT_TOLERANCE),Math.abs(n-r)<u)},sign:function(n,r){return knumber.equal(n,0,r)?0:Math.abs(n)/n},round:function(n,r){var u=Math.pow(10,r);return Math.round(n*u)/u},roundTo:function(n,r){return Math.round(n/r)*r},floorTo:function(n,r){return Math.floor(n/r)*r},ceilTo:function(n,r){return Math.ceil(n/r)*r},isInteger:function(n,r){return knumber.equal(Math.round(n),n,r)},toFraction:function(n,r,u){u=u||1e3,r=r||EPSILON;for(var t=[1,0],o=[0,1],e=Math.floor(n),a=n-e;o[0]<=u;){if(knumber.equal(t[0]/o[0],n,r))return[t[0],o[0]];t=[e*t[0]+t[1],t[0]],o=[e*o[0]+o[1],o[0]],e=Math.floor(1/a),a=1/a-e}return[n,1]}};module.exports=knumber;
},{}],6:[function(require,module,exports){
var kvector=require("./kvector.js"),knumber=require("./knumber.js"),kpoint=KhanUtil.kpoint={rotateRad:function(r,t,o){return void 0===o?kvector.rotateRad(r,t):kvector.add(o,kvector.rotateRad(kvector.subtract(r,o),t))},rotateDeg:function(r,t,o){return void 0===o?kvector.rotateDeg(r,t):kvector.add(o,kvector.rotateDeg(kvector.subtract(r,o),t))},distanceToPoint:function(r,t){return kvector.length(kvector.subtract(r,t))},distanceToLine:function(r,t){var o=kvector.subtract(t[1],t[0]),e=kvector.subtract(r,t[0]),c=kvector.projection(e,o),a=kvector.subtract(c,e);return kvector.length(a)},reflectOverLine:function(r,t){var o=kvector.subtract(t[1],t[0]),e=kvector.subtract(r,t[0]),c=kvector.projection(e,o),a=kvector.subtract(kvector.scale(c,2),e);return kvector.add(t[0],a)},compare:function(r,t,o){if(r.length!==t.length)return r.length-t.length;for(var e=0;e<r.length;e++)if(!knumber.equal(r[e],t[e],o))return r[e]-t[e];return 0}};_.extend(kpoint,{is:kvector.is,addVector:kvector.add,addVectors:kvector.add,subtractVector:kvector.subtract,equal:kvector.equal,polarRadFromCart:kvector.polarRadFromCart,polarDegFromCart:kvector.polarDegFromCart,cartFromPolarRad:kvector.cartFromPolarRad,cartFromPolarDeg:kvector.cartFromPolarDeg,round:kvector.round,roundTo:kvector.roundTo,floorTo:kvector.floorTo,ceilTo:kvector.ceilTo}),module.exports=kpoint;
},{"./knumber.js":5,"./kvector.js":7}],7:[function(require,module,exports){
function arraySum(r){return _.reduce(r,function(r,t){return r+t},0)}function arrayProduct(r){return _.reduce(r,function(r,t){return r*t},1)}var knumber=require("./knumber.js"),kvector=KhanUtil.kvector={is:function(r,t){return _.isArray(r)?void 0!==t&&r.length!==t?!1:_.all(r,knumber.is):!1},normalize:function(r){return kvector.scale(r,1/kvector.length(r))},length:function(r){return Math.sqrt(kvector.dot(r,r))},dot:function(r,t){var n=_.toArray(arguments),e=_.zip.apply(_,n),o=_.map(e,arrayProduct);return arraySum(o)},add:function(){var r=_.toArray(arguments),t=_.zip.apply(_,r);return _.map(t,arraySum)},subtract:function(r,t){return _.map(_.zip(r,t),function(r){return r[0]-r[1]})},negate:function(r){return _.map(r,function(r){return-r})},scale:function(r,t){return _.map(r,function(r){return r*t})},equal:function(r,t,n){return _.all(_.zip(r,t),function(r){return knumber.equal(r[0],r[1],n)})},codirectional:function(r,t,n){return knumber.equal(kvector.length(r),0,n)||knumber.equal(kvector.length(t),0,n)?!0:(r=kvector.normalize(r),t=kvector.normalize(t),kvector.equal(r,t,n))},collinear:function(r,t,n){return kvector.codirectional(r,t,n)||kvector.codirectional(r,kvector.negate(t),n)},polarRadFromCart:function(r){var t=kvector.length(r),n=Math.atan2(r[1],r[0]);return 0>n&&(n+=2*Math.PI),[t,n]},polarDegFromCart:function(r){var t=kvector.polarRadFromCart(r);return[t[0],180*t[1]/Math.PI]},cartFromPolarRad:function(r,t){return _.isUndefined(t)&&(t=r[1],r=r[0]),[r*Math.cos(t),r*Math.sin(t)]},cartFromPolarDeg:function(r,t){return _.isUndefined(t)&&(t=r[1],r=r[0]),kvector.cartFromPolarRad(r,t*Math.PI/180)},rotateRad:function(r,t){var n=kvector.polarRadFromCart(r),e=n[1]+t;return kvector.cartFromPolarRad(n[0],e)},rotateDeg:function(r,t){var n=kvector.polarDegFromCart(r),e=n[1]+t;return kvector.cartFromPolarDeg(n[0],e)},angleRad:function(r,t){return Math.acos(kvector.dot(r,t)/(kvector.length(r)*kvector.length(t)))},angleDeg:function(r,t){return 180*kvector.angleRad(r,t)/Math.PI},projection:function(r,t){var n=kvector.dot(r,t)/kvector.dot(t,t);return kvector.scale(t,n)},round:function(r,t){return _.map(r,function(r,n){return knumber.round(r,t[n]||t)})},roundTo:function(r,t){return _.map(r,function(r,n){return knumber.roundTo(r,t[n]||t)})},floorTo:function(r,t){return _.map(r,function(r,n){return knumber.floorTo(r,t[n]||t)})},ceilTo:function(r,t){return _.map(r,function(r,n){return knumber.ceilTo(r,t[n]||t)})}};module.exports=kvector;
},{"./knumber.js":5}],8:[function(require,module,exports){
var pluck=function(r,c){return _.object(_.map(r,function(r,t){return[t,r[c]]}))},mapObject=function(r,c){var t={};return _.each(_.keys(r),function(e){t[e]=c(r[e],e)}),t},mapObjectFromArray=function(r,c){var t={};return _.each(r,function(r){t[r]=c(r)}),t};module.exports={pluck:pluck,mapObject:mapObject,mapObjectFromArray:mapObjectFromArray};
},{}],9:[function(require,module,exports){
function findChildOrAdd(t,a){var e=$(t).find("."+a);return 0===e.length?$("<span>").addClass(a).appendTo($(t)):e}function doCallback(t,a){var e=0;!function r(){var n=t.scrollHeight;n>18||e>=10?a():(e++,setTimeout(r,100))}()}$.extend(KhanUtil,{processMath:function(t,a,e,r){var n=$(t);if(null==n.attr("data-math-formula")||e){var i=findChildOrAdd(n,"katex-holder"),l=findChildOrAdd(n,"mathjax-holder"),o=l.find("script[type='math/tex']")[0];if(null==a&&(n.attr("data-math-formula")?a=n.attr("data-math-formula"):o&&(a=o.text||o.textContent)),a=null!=a?a+"":"",KhanUtil.cleanMath&&(a=KhanUtil.cleanMath(a)),n.attr("data-math-formula",a),Exercises.useKatex)try{if(katex.render(a,i[0]),"mathjax"===n.attr("data-math-type")){var u=MathJax.Hub.getJaxFor(o);if(u){var h=u.SourceElement();h.previousSibling&&h.previousSibling.className&&u.Remove()}}return n.attr("data-math-type","katex"),void(r&&doCallback(t,r))}catch(d){if(d.__proto__!==katex.ParseError.prototype)throw d}n.attr("data-math-type","mathjax"),o?"text"in o?o.text=a:o.textContent=a:l.append("<script type='math/tex'>"+a.replace(/<\//g,"< /")+"</script>"),"undefined"!=typeof MathJax&&(MathJax.Hub.Queue(["Reprocess",MathJax.Hub,l[0]]),MathJax.Hub.Queue(function(){KhanUtil.debugLog("MathJax done typesetting ("+a+")")}),r&&MathJax.Hub.Queue(function(){var a=MathJax.Callback(function(){});return doCallback(t,function(){r(),a()}),a}))}},processAllMath:function(t,a){var e=$(t);e.filter("code").add(e.find("code")).each(function(){var t=$(this),e=t.attr("data-math-formula");null==e&&(e=t.text(),t.empty()),KhanUtil.processMath(this,e,a)})},cleanupMath:function(t){var a=$(t);if(a.attr("data-math-formula")){if("undefined"!=typeof MathJax){var e=MathJax.Hub.getJaxFor(a.find("script")[0]);if(e){var r=e.SourceElement();r.previousSibling&&r.previousSibling.className&&e.Remove()}}a.text(a.attr("data-math-formula")),a.attr("data-math-formula",null),a.attr("data-math-type",null)}return t},retrieveMathFormula:function(t){return $(t).attr("data-math-formula")}}),$.fn.tex=function(){return KhanUtil.processAllMath(this,!1),this},$.fn.texCleanup=function(){return this.filter("code").add(this.find("code")).each(function(){KhanUtil.cleanupMath(this)}),this};
},{}],10:[function(require,module,exports){
var crc32=require("./crc32.js"),localMode,VARS={};$.tmpl={DATA_ENSURE_LOOPS:0,attr:{"data-ensure":function(t,e){return function(t){var n=!(!e||!$.tmpl.getVAR(e));return!n&&$.tmpl.DATA_ENSURE_LOOPS++>1e4&&localMode?(alert("unsatisfiable data-ensure?"),!0):n}},"data-if":function(t,e){var n=$(t);e=e&&$.tmpl.getVAR(e);var r=n.next();return void 0===r.data("lastCond")&&r.data("lastCond",e),e?void 0:[]},"data-else-if":function(t,e){var n=$(t),r=n.data("lastCond");e=!r&&e&&$.tmpl.getVAR(e);var a=n.next();return void 0===a.data("lastCond")&&a.data("lastCond",r||e),e?void 0:[]},"data-else":function(t){var e=$(t);return e.data("lastCond")?[]:void 0},"data-each":function(t,e){var n;if($(t).removeAttr("data-each"),n=/^(.+) times(?: as (\w+))?$/.exec(e)){var r=$.tmpl.getVAR(n[1]);return{items:$.map(new Array(r),function(t,e){return e}),value:n[2],oldValue:VARS[n[2]]}}return(n=/^(.*?)(?: as (?:(\w+), )?(\w+))?$/.exec(e))?{items:$.tmpl.getVAR(n[1]),value:n[3],pos:n[2],oldValue:VARS[n[3]],oldPos:VARS[n[2]]}:void 0},"data-unwrap":function(t){return $(t).contents()},"data-video-hint":function(t){var e=$(t).data("youtube-id");if(e){e=e.split(/,\s*/);var n=$(t).data("video-hint-author")||"Sal",r=i18n._("Watch %(author)s work through a very similar problem:",{author:n}),a=$("<p>").text(r),i=$("<div>",{"class":"video-hint"});return i.append(a),_.each(e,function(t){var e="http://www.khanacademy.org/embed_video?v="+t,n=$("<iframe>").attr({frameborder:"0",scrolling:"no",width:"100%",height:"360px",src:e});i.append(n)}),i}}},type:{"var":function(t,e){if(!e&&$(t).children().length>0)return function(t){return $.tmpl.type["var"](t,t.innerHTML)};e=e||$.tmpl.getVAR(t);var n=t.id;if(!n){if(null==e)return[];var r=$("<div>"),a=r.append(e+" ").html();return r.html(a.slice(0,-1)).contents()}var i=function(t,e){KhanUtil[t]&&Khan.error("Defining variable '"+t+"' overwrites utility property of same name."),VARS[t]=e};if(-1!==n.indexOf(",")){var o=n.split(/\s*,\s*/);$.each(o,function(t,n){n.length>0&&i(n,e[t])})}else i(n,e)}},getVAR:function(elem,ctx){function doEval(){with(Math)with(KhanUtil)with(ctx)with(VARS)return eval("(function() { return ("+code+"); })()")}var code=elem.nodeName?$(elem).text():elem;if(null==ctx&&(ctx={}),null!=Khan.query.debug)return doEval();try{return doEval()}catch(e){var info;elem.nodeName?(info=elem.nodeName.toLowerCase(),null!=elem.id&&elem.id.length>0&&(info+="#"+elem.id)):info=JSON.stringify(code),Khan.error("Error while evaluating "+info,e)}},getVarsHash:function(){return crc32(JSON.stringify($.map(VARS,function(t,e){return[e,String(t)]})))}},"undefined"!=typeof KhanUtil&&(KhanUtil.tmpl=$.tmpl),$.fn.tmplLoad=function(t,e){VARS={},$.tmpl.DATA_ENSURE_LOOPS=0,localMode=e.localMode,localMode&&($.tmpl.VARS=VARS)},$.fn.tmpl=function(){function t(n){var r=[],a=n.childNodes,i=e(n,r);if(i===!1)return t(n);if(void 0===i);else{if("object"==typeof i&&"undefined"!=typeof i.length)return n.parentNode&&($.each(i,function(t,e){e.nodeType&&n.parentNode.insertBefore(e,n)}),$.each(i,function(e,n){t(n)}),n.parentNode.removeChild(n)),null;if(i.items){var o=n.parentNode,l=n.nextSibling;return $.each(i.items,function(e,r){i.value&&(VARS[i.value]=r),i.pos&&(VARS[i.pos]=e);var a=$(n).clone(!0).removeAttr("data-each").removeData("each")[0],d=["data-if","data-else-if","data-else"],u="";u+=i.pos?"var "+i.pos+" = "+JSON.stringify(e)+";":"",u+=i.value?"var "+i.value+" = "+JSON.stringify(r)+";":"";for(var s=0;s<d.length;s++){var p=d[s];$(a).find("["+p+"]").each(function(){var t=$(this).attr(p);t="(function() { "+u+" return "+t+" })()",$(this).attr(p,t)})}$(a).find(".graphie").addBack().filter(".graphie").each(function(){var t=$(this).text();$(this).text(u+t)}),l?o.insertBefore(a,l):o.appendChild(a),t(a)}),i.value&&(VARS[i.value]=i.oldValue),i.pos&&(VARS[i.pos]=i.oldPos),$(n).remove(),null}}for(var d=0;d<a.length;d++)1===a[d].nodeType&&null===t(a[d])&&d--;for(var d=0,u=r.length;u>d;d++)if(r[d](n)===!1)return t(n);return n}function e(t,e){var n,r=$(t);for(var a in $.tmpl.attr)if($.tmpl.attr.hasOwnProperty(a)){var i;if(i=/^data-/.test(a)?r.data(a.replace(/^data-/,"")):r.attr(a),void 0!==i)if(n=$.tmpl.attr[a](t,i),"function"==typeof n)e.push(n);else if(void 0!==n)return n}var o=t.nodeName.toLowerCase();return null!=$.tmpl.type[o]&&(n=$.tmpl.type[o](t),"function"==typeof n&&e.push(n)),n}for(var n=0,r=this.length;r>n;n++)t(this[n]);return this},$.extend($.expr[":"],{inherited:function(t){return $(t).data("inherited")}}),$.fn.extend({tmplApply:function(t){t=t||{};var e=t.attribute||"id",n=t.defaultApply||"replace",r={};return this.each(function(){var t=$(this),a=t.attr(e),i=t.data("apply")&&!t.data("apply").indexOf("hint");a&&(a in r&&!i?(r[a]=$.tmplApplyMethods[t.data("apply")||n].call(r[a],this),null==r[a]&&delete r[a]):t.closest(":inherited").length>0&&(r[a]=this))})}}),$.extend({tmplApplyMethods:{remove:function(t){$(this).remove(),$(t).remove()},replace:function(t){return $(this).replaceWith(t),t},splice:function(t){$(this).replaceWith($(t).contents())},append:function(t){return $(this).append(t),this},appendContents:function(t){return $(this).append($(t).contents()),$(t).remove(),this},prepend:function(t){return $(this).prepend(t),this},prependContents:function(t){return $(this).prepend($(t).contents()),$(t).remove(),this},before:function(t){return $(this).before(t),this},beforeContents:function(t){return $(this).before($(t).contents()),$(t).remove(),this},after:function(t){return $(this).after(t),this},afterContents:function(t){return $(this).after($(t).contents()),$(t).remove(),this},appendVars:function(t){var e=$(this).data("ensure")||"1",n=$(t).data("ensure")||"1";return $(this).data("ensure","("+e+") && ("+n+")"),$.tmplApplyMethods.appendContents.call(this,t)},prependVars:function(t){var e=$(this).data("ensure")||"1",n=$(t).data("ensure")||"1";return $(this).data("ensure","("+n+") && ("+e+")"),$.tmplApplyMethods.prependContents.call(this,t)}}});
},{"./crc32.js":1}],11:[function(require,module,exports){
function computePrefixedTransform(){var r=document.createElement("div"),n=["transform","msTransform","MozTransform","WebkitTransform","OTransform"],e=null;return _.each(n,function(n){"undefined"!=typeof r.style[n]&&(e=n)}),e}function computeCanUse3dTransform(){var r=document.createElement("div"),n=KhanUtil.getPrefixedTransform();return r.style[n]="translateZ(0px)",!!r.style[n]}var prefixedTransform=null,canUse3dTransform=null;$.extend(KhanUtil,{getPrefixedTransform:function(){return prefixedTransform=prefixedTransform||computePrefixedTransform()},getCanUse3dTransform:function(){return null==canUse3dTransform&&(canUse3dTransform=computeCanUse3dTransform()),canUse3dTransform}});
},{}],12:[function(require,module,exports){
var objective_=require("./objective_.js"),kvector=require("./kvector.js");require("./transform-helpers.js");var PASS_TO_RAPHAEL=["attr","animate"],WrappedDefaults=_.extend({transform:function(e){var t=KhanUtil.getPrefixedTransform();this.wrapper.style[t]=e},toFront:function(){var e=this.wrapper.parentNode;e&&e.appendChild(this.wrapper)},toBack:function(){var e=this.wrapper.parentNode;e.firstChild!==this.wrapper&&e.insertBefore(this.wrapper,e.firstChild)},remove:function(){this.visibleShape.remove(),$(this.wrapper).remove()},getMouseTarget:function(){return this.visibleShape[0]},moveTo:function(e){var t=kvector.subtract(this.graphie.scalePoint(e),this.graphie.scalePoint(this.initialPoint)),r=KhanUtil.getCanUse3dTransform(),i="translateX("+t[0]+"px) translateY("+t[1]+"px)"+(r?" translateZ(0)":"");this.transform(i)},hide:function(){this.visibleShape.hide()},show:function(){this.visibleShape.show()}},objective_.mapObjectFromArray(PASS_TO_RAPHAEL,function(e){return function(){this.visibleShape[e].apply(this.visibleShape,arguments)}}));module.exports=WrappedDefaults;
},{"./kvector.js":7,"./objective_.js":8,"./transform-helpers.js":11}],13:[function(require,module,exports){
var WrappedDefaults=require("./wrapped-defaults.js"),kvector=require("./kvector.js"),DEFAULT_OPTIONS={maxScale:1,mouselayer:!1},WrappedEllipse=function(e,a,r,t){t=_.extend({},DEFAULT_OPTIONS,t),_.extend(this,e.fixedEllipse(a,r,t.maxScale),{graphie:e,initialPoint:a}),t.mouselayer?this.graphie.addToMouseLayerWrapper(this.wrapper):this.graphie.addToVisibleLayerWrapper(this.wrapper)};_.extend(WrappedEllipse.prototype,{animateTo:function(e,a,r){var t=kvector.subtract(this.graphie.scalePoint(e),this.graphie.scalePoint(this.initialPoint)),i=KhanUtil.getCanUse3dTransform(),p=this,s=null,l=null;$(this.wrapper).animate({cx:t[0],cy:t[1]},{duration:a,step:function(e,a){s="cx"===a.prop&&e||null!=s&&s||"cx"===a.prop&&a.start,l="cy"===a.prop&&e||null!=l&&l||"cy"===a.prop&&a.start;var t="translateX("+s+"px) translateY("+l+"px)"+(i?" translateZ(0)":"");p.transform(t);var n=p.graphie.unscalePoint(kvector.add(p.graphie.scalePoint(p.initialPoint),[s,l]));r&&r(n)}})}},WrappedDefaults),module.exports=WrappedEllipse;
},{"./kvector.js":7,"./wrapped-defaults.js":12}],14:[function(require,module,exports){
var WrappedDefaults=require("./wrapped-defaults.js"),kpoint=require("./kpoint.js"),kvector=require("./kvector.js");require("./transform-helpers.js");var DEFAULT_OPTIONS={thickness:2,mouselayer:!1},WrappedLine=function(e,t,r,a){a=_.extend({},DEFAULT_OPTIONS,a);var i=[e.range[0][0],0],n=[e.range[0][1],0];_.extend(this,e.fixedLine(i,n,a.thickness)),_.extend(this,{graphie:e,initialPoint:e.scalePoint(i),initialLength:kpoint.distanceToPoint(e.scalePoint(i),e.scalePoint(n))}),a.mouselayer?this.graphie.addToMouseLayerWrapper(this.wrapper):this.graphie.addToVisibleLayerWrapper(this.wrapper),this.moveTo(t,r)};_.extend(WrappedLine.prototype,WrappedDefaults,{getMouseTarget:function(){return this.wrapper},moveTo:function(e,t){var r=this.graphie.scalePoint(e),a=this.graphie.scalePoint(t),i=kvector.polarDegFromCart(kvector.subtract(a,r)),n=i[0],s=KhanUtil.bound(i[1]),o=kvector.subtract(r,this.initialPoint),p=KhanUtil.bound(n/this.initialLength),h=KhanUtil.getCanUse3dTransform(),l="translateX("+o[0]+"px) translateY("+o[1]+"px) "+(h?"translateZ(0) ":"")+"rotate("+s+"deg) scaleX("+p+") scaleY(1)";this.transform(l)}}),module.exports=WrappedLine;
},{"./kpoint.js":6,"./kvector.js":7,"./transform-helpers.js":11,"./wrapped-defaults.js":12}],15:[function(require,module,exports){
var WrappedDefaults=require("./wrapped-defaults.js"),DEFAULT_OPTIONS={center:null,createPath:null,mouselayer:!1},WrappedPath=function(e,a,r){r=_.extend({},DEFAULT_OPTIONS,r),_.extend(this,e.fixedPath(a,r.center,r.createPath)),_.extend(this,{graphie:e,initialPoint:e.scalePoint(_.head(a))}),r.mouselayer?this.graphie.addToMouseLayerWrapper(this.wrapper):this.graphie.addToVisibleLayerWrapper(this.wrapper)};_.extend(WrappedPath.prototype,WrappedDefaults),module.exports=WrappedPath;
},{"./wrapped-defaults.js":12}],16:[function(require,module,exports){
!function(t,e,n,o){function a(t){for(;t&&"undefined"!=typeof t.originalEvent;)t=t.originalEvent;return t}function i(e,n){var i,r,u,s,c,h,v,d,l=e.type;if(e=t.Event(e),e.type=n,i=e.originalEvent,r=t.event.props,l.search(/mouse/)>-1&&(r=I),i)for(v=r.length,s;v;)s=r[--v],e[s]=i[s];if(l.search(/mouse(down|up)|click/)>-1&&!e.which&&(e.which=1),-1!==l.search(/^touch/)&&(u=a(i),l=u.touches,c=u.changedTouches,h=l&&l.length?l[0]:c&&c.length?c[0]:o))for(d=0,len=Y.length;d<len;d++)s=Y[d],e[s]=h[s];return e}function r(e){for(var n,o,a={};e;){n=t.data(e,y);for(o in n)n[o]&&(a[o]=a.hasVirtualBinding=!0);e=e.parentNode}return a}function u(e,n){for(var o;e;){if(o=t.data(e,y),o&&(!n||o[n]))return e;e=e.parentNode}return null}function s(){V=!1}function c(){V=!0}function h(){z=0,L.length=0,S=!1,c()}function v(){s()}function d(){l(),B=setTimeout(function(){B=0,h()},t.vmouse.resetTimerDuration)}function l(){B&&(clearTimeout(B),B=0)}function f(e,n,o){var a;return(o&&o[e]||!o&&u(n.target,e))&&(a=i(n,e),t(n.target).trigger(a)),a}function p(e){var n=t.data(e.target,P);if(!(S||z&&z===n)){var o=f("v"+e.type,e);o&&(o.isDefaultPrevented()&&e.preventDefault(),o.isPropagationStopped()&&e.stopPropagation(),o.isImmediatePropagationStopped()&&e.stopImmediatePropagation())}}function g(e){var n,o,i=a(e).touches;if(i&&1===i.length&&(n=e.target,o=r(n),o.hasVirtualBinding)){z=q++,t.data(n,P,z),l(),v(),H=!1;var u=a(e).touches[0];N=u.pageX,x=u.pageY,f("vmouseover",e,o),f("vmousedown",e,o)}}function m(t){V||(H||f("vmousecancel",t,r(t.target)),H=!0,d())}function b(e){if(!V){var n=a(e).touches[0],o=H,i=t.vmouse.moveDistanceThreshold;H=H||Math.abs(n.pageX-N)>i||Math.abs(n.pageY-x)>i,flags=r(e.target),H&&!o&&f("vmousecancel",e,flags),f("vmousemove",e,flags),d()}}function D(t){if(!V){c();var e,n=r(t.target);if(f("vmouseup",t,n),!H){var o=f("vclick",t,n);o&&o.isDefaultPrevented()&&(e=a(t).changedTouches[0],L.push({touchID:z,x:e.clientX,y:e.clientY}),S=!0)}f("vmouseout",t,n),H=!1,d()}}function T(e){var n,o=t.data(e,y);if(o)for(n in o)if(o[n])return!0;return!1}function k(){}function w(e){var n=e.substr(1);return{setup:function(o,a){T(this)||t.data(this,y,{});var i=t.data(this,y);i[e]=!0,M[e]=(M[e]||0)+1,1===M[e]&&Q.bind(n,p),t(this).bind(n,k),j&&(M.touchstart=(M.touchstart||0)+1,1===M.touchstart&&Q.bind("touchstart",g).bind("touchend",D).bind("touchmove",b).bind("scroll",m))},teardown:function(o,a){--M[e],M[e]||Q.unbind(n,p),j&&(--M.touchstart,M.touchstart||Q.unbind("touchstart",g).unbind("touchmove",b).unbind("touchend",D).unbind("scroll",m));var i=t(this),r=t.data(this,y);r&&(r[e]=!1),i.unbind(n,k),T(this)||i.removeData(y)}}}var y="virtualMouseBindings",P="virtualTouchID",X="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),Y="clientX clientY pageX pageY screenX screenY".split(" "),E=t.event.mouseHooks?t.event.mouseHooks.props:[],I=t.event.props.concat(E),M={},B=0,N=0,x=0,H=!1,L=[],S=!1,V=!1,j="addEventListener"in n,Q=t(n),q=1,z=0;t.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};for(var A=0;A<X.length;A++)t.event.special[X[A]]=w(X[A]);j&&n.addEventListener("click",function(e){var n,o,a,i,r,u,s=L.length,c=e.target;if(s)for(n=e.clientX,o=e.clientY,threshold=t.vmouse.clickDistanceThreshold,a=c;a;){for(i=0;s>i;i++)if(r=L[i],u=0,a===c&&Math.abs(r.x-n)<threshold&&Math.abs(r.y-o)<threshold||t.data(a,P)===r.touchID)return e.preventDefault(),void e.stopPropagation();a=a.parentNode}},!0)}(jQuery,window,document);
},{}]},{},[3]);
