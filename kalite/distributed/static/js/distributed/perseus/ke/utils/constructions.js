(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var kmatrix=require("./kmatrix.js");$.extend(KhanUtil,{drawHintLine:function(t,o,e){var n=KhanUtil.currentGraph,i=KhanUtil.eDist(t,o),r=[(t[0]+o[0])/2,(t[1]+o[1])/2],a=Math.atan2(o[1]-t[1],o[0]-t[0]),s=function(t){var o=kmatrix.makeMatrix([[Math.cos(a),-Math.sin(a),r[0]],[Math.sin(a),Math.cos(a),r[1]],[0,0,1]]),e=kmatrix.makeMatrix([[t[0]],[t[1]],[1]]),n=kmatrix.matrixMult(o,e);return[n[0],n[1]]},l=n.raphael.set();return l.push(n.line(s([-i/2,0]),s([i/2,0]),{stroke:KhanUtil.BLUE,strokeWidth:1,strokeDasharray:"- "})),n.style({stroke:KhanUtil.BLUE,strokeWidth:1},function(){1===e?l.push(n.line(s(n.unscaleVector([0,6])),s(n.unscaleVector([0,-6])))):2===e?(l.push(n.line(s(n.unscaleVector([-3,6])),s(n.unscaleVector([-3,-6])))),l.push(n.line(s(n.unscaleVector([3,6])),s(n.unscaleVector([3,-6]))))):3===e&&(l.push(n.line(s(n.unscaleVector([-6,6])),s(n.unscaleVector([-6,-6])))),l.push(n.line(s(n.unscaleVector([0,6])),s(n.unscaleVector([0,-6])))),l.push(n.line(s(n.unscaleVector([6,6])),s(n.unscaleVector([6,-6])))))}),l},construction:{},showSnapPts:function(){var t=KhanUtil.currentGraph,o=t.raphael.set();_.each(KhanUtil.construction.interPoints,function(e){o.push(t.circle(e,.1,{stroke:KhanUtil.PINK,fill:KhanUtil.PINK}))}),_.each(KhanUtil.construction.snapPoints,function(e){o.push(t.circle(e.coord,.1,{stroke:KhanUtil.RED,fill:KhanUtil.RED}))}),_.delay(function(){o.remove()},500)},addConstruction:function(t){var o=$("#"+t).data("graphie"),e=KhanUtil.construction={tools:[],tool:{},snapPoints:[],interPoints:[],snapLines:[]};e.addCompass=function(){var t=[4*Math.random()-2,4*Math.random()-2],n=Math.random()+1.5;e.tool={interType:"circle",center:o.addMovablePoint({graph:o,coord:t,normalStyle:{stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE}}),radius:n,circ:o.circle(t,n,{stroke:KhanUtil.BLUE,strokeDasharray:"- ",fill:KhanUtil.ORANGE,fillOpacity:0}),perim:o.mouselayer.circle(o.scalePoint(t)[0],o.scalePoint(t)[1],o.scaleVector(n)[0]).attr({"stroke-width":20,opacity:0})};var i=e.tool;$(i.center.mouseTarget.getMouseTarget()).bind("vmouseover vmouseout",function(t){i.center.highlight?i.circ.animate({stroke:KhanUtil.ORANGE,"fill-opacity":.05},50):i.circ.animate({stroke:KhanUtil.BLUE,"fill-opacity":0},50)}),e.tools.push(i),e.snapPoints.push(i.center),i.center.onMove=function(t,e){i.circ.toFront(),i.perim.toFront(),i.center.visibleShape.toFront(),i.center.mouseTarget.toFront(),i.circ.attr({cx:o.scalePoint(t)[0],cy:o.scalePoint(e)[1]}),i.perim.attr({cx:o.scalePoint(t)[0],cy:o.scalePoint(e)[1]})},i.center.onMoveEnd=function(t,o){_.each(e.snapLines,function(t){var o=KhanUtil.lDist(i.center.coord,t);o[0]<.25&&(i.center.onMove(o[1][0],o[1][1]),i.center.setCoord(o[1]))});var n=[];_.each(e.snapPoints,function(t){KhanUtil.eDist(i.center.coord,t.coord)<.25&&i.center.coord!==t.coord&&n.push(t.coord)}),e.updateIntersections(),_.each(e.interPoints,function(t){KhanUtil.eDist(i.center.coord,t)<.3&&i.center.coord!==t&&n.push(t)});var r=[],a=null;_.each(n,function(t){(null==a||KhanUtil.eDist(t,i.center.coord)<a)&&(r=t,a=KhanUtil.eDist(t,i.center.coord))}),r.length>0&&(i.center.onMove(r[0],r[1]),i.center.setCoord(r))},$(i.perim[0]).css("cursor","move"),$(i.perim[0]).bind("vmouseover vmouseout vmousedown",function(t){if("vmouseover"===t.type)i.highlight=!0,KhanUtil.dragging||(i.circ.animate({stroke:KhanUtil.ORANGE,"fill-opacity":.05},50),i.center.visibleShape.animate({stroke:KhanUtil.ORANGE,fill:KhanUtil.ORANGE},50));else if("vmouseout"===t.type)i.highlight=!1,i.dragging||(i.circ.animate({stroke:KhanUtil.BLUE,"fill-opacity":0},50),i.center.visibleShape.animate({stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE},50));else if("vmousedown"===t.type&&(1===t.which||0===t.which)){t.preventDefault();var n=i;n.circ.toFront(),n.perim.toFront(),n.center.visibleShape.toFront(),n.center.mouseTarget.toFront(),$(document).bind("vmousemove vmouseup",function(t){if(t.preventDefault(),n.dragging=!0,KhanUtil.dragging=!0,"vmousemove"===t.type){var i=t.pageX-$(o.raphael.canvas.parentNode).offset().left,r=t.pageY-$(o.raphael.canvas.parentNode).offset().top;n.radius=KhanUtil.eDist(n.center.coord,o.unscalePoint([i,r])),n.perim.attr({r:o.scaleVector(n.radius)[0]}),n.circ.attr({rx:o.scaleVector(n.radius)[0],ry:o.scaleVector(n.radius)[1]})}else"vmouseup"===t.type&&($(document).unbind("vmousemove vmouseup"),n.dragging=!1,KhanUtil.dragging=!1,e.updateIntersections())})}}),e.updateIntersections()},e.mark=function(){var t=-1,n=2*Math.random();e.tool={interType:"line",center:o.addMovablePoint({graph:o,coordX:t,coordY:n,normalStyle:{stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE}})},e.tool.line1=o.addMovableLineSegment({graph:o,pointA:[t+.2,n+.2],pointZ:[t-.2,n-.2],normalStyle:{stroke:KhanUtil.BLUE,"stroke-width":2},highlightStyle:{stroke:KhanUtil.ORANGE,"stroke-width":3},movePointsWithLine:!0}),e.tool.line2=o.addMovableLineSegment({graph:o,pointA:[t+.2,n-.2],pointZ:[t-.2,n+.2],normalStyle:{stroke:KhanUtil.BLUE,"stroke-width":2},highlightStyle:{stroke:KhanUtil.ORANGE,"stroke-width":3},movePointsWithLine:!0}),$(e.tool.center.mouseTarget.getMouseTarget()).bind("vmouseover vmouseout",e.tool,function(t){t.data.center.highlight?(t.data.line1.visibleLine.animate({stroke:KhanUtil.ORANGE},50),t.data.line2.visibleLine.animate({stroke:KhanUtil.ORANGE},50)):(t.data.line1.visibleLine.animate({stroke:KhanUtil.BLUE},50),t.data.line2.visibleShape.animate({stroke:KhanUtil.BLUE},50))}),e.tools.push(e.tool),e.snapPoints.push(e.tool.center);var i=e.tool;i.center.onMoveEnd=function(t,o){i.line1.visibleLine.toFront(),i.line1.mouseTarget.toFront(),i.line2.visibleLine.toFront(),i.line2.mouseTarget.toFront(),i.center.visibleShape.toFront(),i.center.mouseTarget.toFront()},$(i.center.mouseTarget.getMouseTarget()).bind("dblclick",function(){e.removeTool(i,!0)}),e.updateIntersections()},e.addStraightedge=function(t,n){t=null==t?!0:t,n=null==n?!1:n,e.tool={interType:"line",first:o.addMovablePoint({graph:o,coordX:-1,coordY:2*Math.random(),normalStyle:{stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE}}),second:o.addMovablePoint({graph:o,coordX:1,coordY:2*Math.random(),normalStyle:{stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE}})},e.tool.edge=o.addMovableLineSegment({graph:o,pointA:e.tool.first,pointZ:e.tool.second,normalStyle:{stroke:KhanUtil.BLUE,"stroke-width":2},highlightStyle:{stroke:KhanUtil.ORANGE,"stroke-width":3},extendLine:t,constraints:{fixed:n},movePointsWithLine:!0}),$(e.tool.first.mouseTarget.getMouseTarget()).bind("vmouseover vmouseout",e.tool,function(t){t.data.first.highlight?(t.data.edge.visibleLine.animate({stroke:KhanUtil.ORANGE},50),t.data.second.visibleShape.animate({stroke:KhanUtil.ORANGE,fill:KhanUtil.ORANGE},50)):(t.data.edge.visibleLine.animate({stroke:KhanUtil.BLUE},50),t.data.second.visibleShape.animate({stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE},50))}),$(e.tool.second.mouseTarget.getMouseTarget()).bind("vmouseover vmouseout",e.tool,function(t){t.data.second.highlight?(t.data.edge.visibleLine.animate({stroke:KhanUtil.ORANGE},50),t.data.first.visibleShape.animate({stroke:KhanUtil.ORANGE,fill:KhanUtil.ORANGE},50)):(t.data.edge.visibleLine.animate({stroke:KhanUtil.BLUE},50),t.data.first.visibleShape.animate({stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE},50))}),$(e.tool.edge.mouseTarget.getMouseTarget()).bind("vmouseover vmouseout",e.tool,function(t){t.data.edge.highlight?(t.data.first.visibleShape.animate({stroke:KhanUtil.ORANGE,fill:KhanUtil.ORANGE},50),t.data.second.visibleShape.animate({stroke:KhanUtil.ORANGE,fill:KhanUtil.ORANGE},50)):(t.data.first.visibleShape.animate({stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE},50),t.data.second.visibleShape.animate({stroke:KhanUtil.BLUE,fill:KhanUtil.BLUE},50))}),e.tools.push(e.tool),e.snapPoints.push(e.tool.first),e.snapPoints.push(e.tool.second),e.snapLines.push(e.tool.edge);var i=e.tool;i.edge.onMoveEnd=function(t,o){i.edge.visibleLine.toFront(),i.edge.mouseTarget.toFront(),i.first.visibleShape.toFront(),i.first.mouseTarget.toFront(),i.second.visibleShape.toFront(),i.second.mouseTarget.toFront(),i.first.onMoveEnd(i.first.coord[0],i.first.coord[1]),i.second.onMoveEnd(i.second.coord[0],i.second.coord[1])};var r=function(t,o,n){_.each(e.snapLines,function(t){var o=KhanUtil.lDist(n.coord,t);o[0]<.25&&(n.setCoord(o[1]),n.updateLineEnds())});var r=[];_.each(e.snapPoints,function(t){KhanUtil.eDist(n.coord,t.coord)<.25&&n.coord!==t.coord&&r.push(t.coord)}),e.updateIntersections(),_.each(e.interPoints,function(t){KhanUtil.eDist(n.coord,t)<.3&&n.coord!==t&&r.push(t)});var a=[],s=null;_.each(r,function(t){(null==s||KhanUtil.eDist(t,n.coord)<s)&&(a=t,s=KhanUtil.eDist(t,n.coord))}),a.length>0&&(n.setCoord(a),n.updateLineEnds()),i.edge.visibleLine.toFront(),i.edge.mouseTarget.toFront(),i.first.visibleShape.toFront(),i.first.mouseTarget.toFront(),i.second.visibleShape.toFront(),i.second.mouseTarget.toFront()};i.first.onMoveEnd=function(t,o){r(t,o,i.first)},i.second.onMoveEnd=function(t,o){r(t,o,i.second)},$(i.first.mouseTarget.getMouseTarget()).bind("dblclick",function(){e.removeTool(i,!0)}),$(i.second.mouseTarget.getMouseTarget()).bind("dblclick",function(){e.removeTool(i,!0)}),$(i.edge.mouseTarget.getMouseTarget()).bind("dblclick",function(){e.removeTool(i,!0)}),e.updateIntersections()},e.removeTool=function(t,o){_.each(_.keys(t),function(o){"center"===o||"perimeter"===o||"first"===o||"second"===o?(t[o].visibleShape.remove(),t[o].visible=!1,$(t[o].mouseTarget.getMouseTarget()).remove()):"circ"===o?t[o].remove():"edge"===o&&t[o].remove()}),o&&e.tools.splice(_.indexOf(e.tools,t),1)},e.removeAllTools=function(){var t=[];_.each(e.tools,function(o){o.dummy?t.push(o):e.removeTool(o,!1)}),e.tools=t,e.snapPoints=e.snapPoints.filter(function(t){return t.dummy}),e.interPoints=[],e.snapLines=e.snapLines.filter(function(t){return t.dummy})},e.updateIntersections=function(){e.interPoints=[],_.each(e.tools,function(t){_.each(e.tools,function(o){if(t!==o)if("line"===t.interType&&"line"===o.interType)e.interPoints.push(findIntersection([t.first.coord,t.second.coord],[o.first.coord,o.second.coord]).slice(0,2));else if("line"===t.interType&&"circle"===o.interType){var n=(t.second.coord[1]-t.first.coord[1])/(t.second.coord[0]-t.first.coord[0]),i=t.first.coord[1]-n*t.first.coord[0],r=o.center.coord[0],a=o.center.coord[1],s=o.radius,l=1+Math.pow(n,2),c=-2*r+2*n*i-2*a*n,u=Math.pow(i,2)-2*i*a+Math.pow(a,2)+Math.pow(r,2)-Math.pow(s,2),d=(-c+Math.sqrt(Math.pow(c,2)-4*l*u))/(2*l),h=(-c-Math.sqrt(Math.pow(c,2)-4*l*u))/(2*l);if(!isNaN(d)){var p=n*d+i;e.interPoints.push([d,p])}if(!isNaN(h)){var f=n*h+i;e.interPoints.push([h,f])}}else if(null!=t.center&&null!=o.center){var l=t.center.coord[0],c=t.center.coord[1],u=o.center.coord[0],m=o.center.coord[1],v=t.radius,U=o.radius,g=u-l,K=m-c,M=Math.sqrt(Math.pow(g,2)+Math.pow(K,2)),k=(Math.pow(M,2)+Math.pow(v,2)-Math.pow(U,2))/(2*M),d=l+g*k/M+K/M*Math.sqrt(Math.pow(v,2)-Math.pow(k,2)),p=c+K*k/M-g/M*Math.sqrt(Math.pow(v,2)-Math.pow(k,2)),h=l+g*k/M-K/M*Math.sqrt(Math.pow(v,2)-Math.pow(k,2)),f=c+K*k/M+g/M*Math.sqrt(Math.pow(v,2)-Math.pow(k,2));isNaN(d)||e.interPoints.push([d,p]),isNaN(h)||e.interPoints.push([h,f])}})})}},addDummyStraightedge:function(t,o,e){var n=KhanUtil.construction;e=null==e?!0:e,n.tool={interType:"line",dummy:!0,first:{coord:[t,o]},second:{coord:[t,o]},edge:KhanUtil.currentGraph.addMovableLineSegment({coordA:t,coordZ:o,normalStyle:{stroke:"black","stroke-width":2},highlightStyle:{stroke:KhanUtil.BLUE,"stroke-width":3},extendLine:e,fixed:!0})},n.tool.edge.dummy=!0,null==n.tools?n.tools=[n.tool]:n.tools.push(n.tool),null==n.snapLines?n.snapLines=[n.tool.edge]:n.snapLines.push(n.tool.edge),KhanUtil.construction.updateIntersections()},addDummyCircle:function(t,o){var e=KhanUtil.construction,n={coord:t,dummy:!0};KhanUtil.currentGraph.circle(t,{r:o,fill:"none",stroke:"black","stroke-width":2}),null==e.snapPoints?e.snapPoints=[n]:e.snapPoints.push(n),KhanUtil.construction.updateIntersections()},addDummyPoint:function(t){var o={coord:t,dummy:!0};KhanUtil.currentGraph.circle(t,{r:.08,fill:"black",stroke:"none"});var e=KhanUtil.construction;null==e.snapPoints?e.snapPoints=[o]:e.snapPoints.push(o),KhanUtil.construction.updateIntersections()},addDummyRay:function(t,o){var e=KhanUtil.construction;e.tool={interType:"line",dummy:!0,first:{coord:t},second:{coord:o},edge:{coordA:t,coordZ:o,dummy:!0}},KhanUtil.currentGraph.line(t,o,{stroke:"black","stroke-width":2,arrows:"->"}),KhanUtil.addDummyPoint(t),null==e.tools?e.tools=[e.tool]:e.tools.push(e.tool),null==e.snapLines?e.snapLines=[e.tool.edge]:e.snapLines.push(e.tool.edge),KhanUtil.construction.updateIntersections()},constructionGuess:null,showConstructionGuess:function(t){var o=KhanUtil.currentGraph;null!=KhanUtil.constructionGuess&&KhanUtil.constructionGuess.remove(),KhanUtil.constructionGuess=o.raphael.set(),_.each(t,function(t){null!=t.first?(KhanUtil.constructionGuess.push(o.addMovableLineSegment({coordA:t.first.coord,coordZ:t.second.coord,normalStyle:{stroke:KhanUtil.BLUE,"stroke-width":2},extendLine:!0,fixed:!0}).visibleLine),KhanUtil.constructionGuess.push(o.circle(t.first.coord,.1,{fill:KhanUtil.BLUE,stroke:null})),KhanUtil.constructionGuess.push(o.circle(t.second.coord,.1,{fill:KhanUtil.BLUE,stroke:null}))):null!=t.center&&(KhanUtil.constructionGuess.push(o.circle(t.center.coord,.1,{fill:KhanUtil.BLUE,stroke:null})),KhanUtil.constructionGuess.push(o.circle(t.center.coord,t.radius,{fill:"none",stroke:KhanUtil.BLUE,strokeDasharray:"- "})))})},eDist:function(t,o){return Math.sqrt(Math.pow(t[0]-o[0],2)+Math.pow(t[1]-o[1],2))},lDist:function(t,o){var e,n=(o.coordZ[1]-o.coordA[1])/(o.coordZ[0]-o.coordA[0]),i=0===n?"vert":-1/n;e="vert"===i?[t[0],t[1]+1]:[t[0]+1,t[1]+i];var r=findIntersection([t,e],[o.coordA,o.coordZ]);return[KhanUtil.eDist(r,t),r]},distEqual:function(t,o,e,n){return n=n||.5,Math.abs(KhanUtil.eDist(t,o)-e)<n},angleEqual:function(t,o,e){var n=Math.atan2(t.second.coord[1]-t.first.coord[1],t.second.coord[0]-t.first.coord[0]);return n*=180/Math.PI,0>n&&(n+=180),Math.abs(o-n)<e},getToolProperties:function(t){return _.map(_.filter(t.tools,function(t){return t.dummy!==!0}),function(t){return null!=t.first?{first:{coord:[t.first.coord[0],t.first.coord[1]]},second:{coord:[t.second.coord[0],t.second.coord[1]]}}:null!=t.center?{center:{coord:[t.center.coord[0],t.center.coord[1]]},radius:t.radius}:void 0})},findCompass:function(t,o){var e=[];return null!=o.radius&&e.push(function(t){return Math.abs(t.radius-o.radius)<.5}),null!=o.cx&&e.push(function(t){return Math.abs(t.center.coord[0]-o.cx)<.5}),null!=o.cy&&e.push(function(t){return Math.abs(t.center.coord[1]-o.cy)<.5}),null!=o.center&&e.push(function(t){return Math.abs(t.center.coord[0]-o.center[0])<.5&&Math.abs(t.center.coord[1]-o.center[1])<.5}),_.filter(t,function(t){if(null!=t.center){for(var o=0;o<e.length;o++)if(!e[o](t))return!1;return!0}})},findInscribedPolygon:function(t,o,e,n){var i=2*Math.PI/n,r=2*e*Math.sin(i/2),a=_.filter(t,function(t){return null!=t.first&&KhanUtil.distEqual(t.first.coord,t.second.coord,r,.3)&&KhanUtil.distEqual(t.first.coord,o,e,.3)&&KhanUtil.distEqual(t.second.coord,o,e,.3)});if(a.length<n)return!1;var s=180+180*Math.atan2(a[0].first.coord[1],a[0].first.coord[0])/Math.PI,l=[];_.map(a,function(t){var o=180*Math.atan2(t.first.coord[1],t.first.coord[0])/Math.PI,e=180*Math.atan2(t.second.coord[1],t.second.coord[0])/Math.PI;l.push((o-s+540+180/n)%360),l.push((e-s+540+180/n)%360)});for(var c={},u=0;n>u;u++)c[360*(u+.5)/n]=0;var d=4;_.map(l,function(t){for(var o=0;n>o;o++){var e=360*(o+.5)/n;if(Math.abs(t-e)<d){c[e]++;break}}});for(var h in c)if(2!==c[h])return!1;return a}});
},{"./kmatrix.js":3}],2:[function(require,module,exports){
$.extend(KhanUtil,{expr:function(e,r){if("object"==typeof e){var t=e[0],n=e.slice(1),a=r?KhanUtil.computeOperators:KhanUtil.formatOperators;return a[t].apply(this,n)}return r?e:e.toString()},exprType:function(e){return"object"==typeof e?"color"===e[0]?KhanUtil.exprType(e[2]):e[0]:typeof e},exprIsNegated:function(e){switch(KhanUtil.exprType(e)){case"color":return KhanUtil.exprIsNegated(e[2]);case"/":return KhanUtil.exprIsNegated(e[1]);case"+":case"-":return!0;case"number":return 0>e;case"string":return"-"===e.charAt(0);default:return!1}},exprIsShort:function(e){switch(KhanUtil.exprType(e)){case"color":return KhanUtil.exprIsShort(e[2]);case"+":case"-":case"*":case"/":case"frac":return!1;case"^":return"number"!==KhanUtil.exprType(e[1])||e[1]<0;case"number":case"sqrt":return!0;default:return e.length<=1}},exprParenthesize:function(e){return KhanUtil.exprIsShort(e)?KhanUtil.expr(e):"("+KhanUtil.expr(e)+")"},formatOperators:{color:function(e,r){return"\\color{"+e+"}{"+KhanUtil.expr(r)+"}"},"+":function(){var e=[].slice.call(arguments,0),r=$.grep(e,function(e,r){return null!=e});r=_.filter(r,function(e){return""+KhanUtil.expr(e)!="0"}),r=$.map(r,function(e,r){var t;switch(KhanUtil.exprType(e)){case"+":t=!0;break;case"-":t=e.length>2;break;default:t=!1}return e=KhanUtil.expr(e),t&&(e="("+e+")"),("-"!==e.charAt(0)||t)&&(e="+"+e),e});var t=r.join("");return"+"===t.charAt(0)?t.slice(1):t},"-":function(){if(1===arguments.length)return KhanUtil.expr(["*",-1,arguments[0]]);var e=[].slice.call(arguments,0),r=$.map(e,function(e,r){var t,n=KhanUtil.exprIsNegated(e);switch(KhanUtil.exprType(e)){case"+":case"-":t=!0;break;default:t=!1}return e=KhanUtil.expr(e),(n&&r>0||t)&&(e="("+e+")"),e}),t=r.join("-");return t},"*":function(){var e=Array.prototype.slice.call(arguments,1);if(e.unshift("*"),0===arguments[0])return 0;if(1===arguments[0]&&e.length>1)return KhanUtil.expr(e);if(-1===arguments[0]&&e.length>1){var r=KhanUtil.expr(e);return KhanUtil.exprIsNegated(e[1])?"-("+r+")":"-"+r}if(arguments.length>1){var t=[].slice.call(arguments,0),n="number"===KhanUtil.exprType(arguments[0])&&"number"===KhanUtil.exprType(arguments[1]),a=$.map(t,function(e,r){var t;switch(KhanUtil.exprType(e)){case"number":r>0&&(t=!0);break;default:t=!KhanUtil.exprIsShort(e)}return n=n||t,e=KhanUtil.expr(e),n&&(e="("+e+")"),e});return a.join("")}return KhanUtil.expr(arguments[0])},times:function(e,r){var t=!KhanUtil.exprIsShort(e),n=!KhanUtil.exprIsShort(r);return e=KhanUtil.expr(e),r=KhanUtil.expr(r),e=t?"("+e+")":e,r=n?"("+r+")":r,e+" \\times "+r},dot:function(e,r){var t=!KhanUtil.exprIsShort(e),n=!KhanUtil.exprIsShort(r);return e=KhanUtil.expr(e),r=KhanUtil.expr(r),e=t?"("+e+")":e,r=n?"("+r+")":r,e+" \\cdot "+r},"/":function(e,r){var t=!KhanUtil.exprIsShort(e),n=!KhanUtil.exprIsShort(r);return e=KhanUtil.expr(e),r=KhanUtil.expr(r),e=t?"("+e+")":e,r=n?"("+r+")":r,e+"/"+r},frac:function(e,r){return"\\dfrac{"+KhanUtil.expr(e)+"}{"+KhanUtil.expr(r)+"}"},"^":function(e,r){if(0===r)return"";if(1===r)return KhanUtil.expr(e);var t,n;switch(KhanUtil.exprType(e)){case"+":case"-":case"*":case"/":case"^":case"ln":t=!0;break;case"number":t=0>e;break;case"sin":case"cos":case"tan":case"csc":case"sec":case"cot":t=!1,n=!0;break;default:t=!1,n=!1}return e=KhanUtil.expr(e),t&&(e="("+e+")"),r=KhanUtil.expr(r),n?e.replace(/\\(\S+?)\{/,function(e,t){return"\\"+t+"^{"+r+"} {"}):e+"^{"+r+"}"},sqrt:function(e){return"\\sqrt{"+KhanUtil.exprParenthesize(e)+"}"},sin:function(e){return"\\sin{"+KhanUtil.exprParenthesize(e)+"}"},cos:function(e){return"\\cos{"+KhanUtil.exprParenthesize(e)+"}"},tan:function(e){return"\\tan{"+KhanUtil.exprParenthesize(e)+"}"},sec:function(e){return"\\sec{"+KhanUtil.exprParenthesize(e)+"}"},csc:function(e){return"\\sec{"+KhanUtil.exprParenthesize(e)+"}"},cot:function(e){return"\\sec{"+KhanUtil.exprParenthesize(e)+"}"},ln:function(e){return"\\ln{"+KhanUtil.exprParenthesize(e)+"}"},"+-":function(){if(1===arguments.length)return"\\pm "+KhanUtil.exprParenthesize(arguments[0]);var e=[].slice.call(arguments,0);return $.map(e,function(e,r){return KhanUtil.expr(e)}).join(" \\pm ")}},computeOperators:{color:function(e,r){return KhanUtil.expr(r,!0)},"+":function(){var e=[].slice.call(arguments,0),r=0;return $.each(e,function(e,t){r+=KhanUtil.expr(t,!0)}),r},"-":function(){if(1===arguments.length)return-KhanUtil.expr(arguments[0],!0);var e=[].slice.call(arguments,0),r=0;return $.each(e,function(e,t){r+=(0===e?1:-1)*KhanUtil.expr(t,!0)}),r},"*":function(){var e=[].slice.call(arguments,0),r=1;return $.each(e,function(e,t){r*=KhanUtil.expr(t,!0)}),r},"/":function(){var e=[].slice.call(arguments,0),r=1;return $.each(e,function(e,t){var n=KhanUtil.expr(t,!0);r*=0===e?n:1/n}),r},"^":function(e,r){return Math.pow(KhanUtil.expr(e,!0),KhanUtil.expr(r,!0))},sqrt:function(e){return Math.sqrt(KhanUtil.expr(e,!0))},"+-":function(){return NaN}},exprStripColor:function(e){return"object"!=typeof e?e:"color"===e[0]?KhanUtil.exprStripColor(e[2]):$.map(e,function(e,r){return[0===r?e:KhanUtil.exprStripColor(e)]})},exprSimplifyAssociative:function(e){if("object"!=typeof e)return e;var r=$.map(e.slice(1),function(e){return[KhanUtil.exprSimplifyAssociative(e)]}),t=function(r){switch(e[0]){case"+":if("+"===r[0])return r.slice(1);break;case"*":if("*"===r[0])return r.slice(1)}return[r]},n=$.map(r,t);return n.unshift(e[0]),n}}),KhanUtil.computeOperators.frac=KhanUtil.computeOperators["/"];
},{}],3:[function(require,module,exports){
require("./expressions.js");var kmatrix=KhanUtil.kmatrix={deepZipWith:function(r,t){var i=[].slice.call(arguments,2),n=_.any(i,function(r){return null===r?!0:void 0});return n?null:0===r?t.apply(null,i):_.map(_.zip.apply(_,i),function(i){return kmatrix.deepZipWith.apply(this,[r-1,t].concat(i))})},matrixCopy:function(r){return $.extend(!0,[],r)},matrixMap:function(r,t){return _.map(t,function(t,i){return _.map(t,function(t,n){return r(t,i,n)})})},maskMatrix:function(r,t){var i=[];return _.times(r.r,function(n){var a=[];_.times(r.c,function(i){KhanUtil.contains(t,[n+1,i+1])?a.push(r[n][i]):a.push("?")}),i.push(a)}),i},printMatrix:function(r){var t=Array.prototype.slice.call(arguments),i=kmatrix.deepZipWith.apply(this,[2].concat(t));if(!i)return null;var n=_.map(i,function(r,t){return r.join(" & ")}).join(" \\\\ "),a="\\left[\\begin{array}",e="\\end{array}\\right]",u="{",m=i[0].length;return _(m).times(function(){u+="r"}),u+="}",a+u+n+e},printSimpleMatrix:function(r,t){return kmatrix.printMatrix(function(r){return t?KhanUtil.colorMarkup(r,t):r},r)},printFractionMatrix:function(r,t){return kmatrix.printMatrix(function(r){return r=KhanUtil.decimalFraction(r,!0),t?KhanUtil.colorMarkup(r,t):r},r)},printSimpleMatrixDet:function(r,t){return kmatrix.printSimpleMatrix(r,t).replace("left[","left|").replace("right]","right|")},printColoredDimMatrix:function(r,t,i){var n=kmatrix.matrixMap(function(r,n,a){var e=t[i?n:a];return KhanUtil.colorMarkup(r,e)},r);return kmatrix.printSimpleMatrix(n)},makeMultHintMatrix:function(r,t,i,n){var a=[];return _.times(r.r,function(){a.push([])}),_.times(r.r,function(e){var u=i[e];_.times(t.c,function(i){var m=n[i],c="";_.times(r.c,function(n){n>0&&(c+="+");var a=KhanUtil.colorMarkup(r[e][n],u),o=KhanUtil.colorMarkup(t[n][i],m);c+=a+"\\cdot"+o}),a[e][i]=c})}),kmatrix.makeMatrix(a)},makeMatrix:function(r){return r.r=r.length,r.c=r[0].length,r},cropMatrix:function(r,t,i){var n=kmatrix.matrixCopy(r);return n.splice(t,1),_.each(n,function(r){r.splice(i,1)}),n},matrix2x2DetHint:function(r){var t="string"==typeof r[0][0]?" \\times ":" \\cdot ",i="("+r[0][0]+t+r[1][1]+")",n="("+r[0][1]+t+r[1][0]+")";return i+"-"+n},matrix3x3DetHint:function(r,t){var i="";return _.times(r.c,function(n){var a=kmatrix.cropMatrix(r,0,n),e=n%2?"-":"+";e=0===n?"":e;var u,m=r[0][n];t?u=kmatrix.printSimpleMatrixDet(a):(u=kmatrix.matrix2x2DetHint(a),u=KhanUtil.exprParenthesize(u)),i+=e+m+u}),i},matrixMult:function(r,t){r=kmatrix.makeMatrix(r),t=kmatrix.makeMatrix(t);var i=[];return _.times(r.r,function(){i.push([])}),_.times(r.r,function(n){_.times(t.c,function(a){var e=0;_.times(r.c,function(i){e+=r[n][i]*t[i][a]}),i[n][a]=e})}),kmatrix.makeMatrix(i)},matrixMinors:function(r){if(r=kmatrix.makeMatrix(r),!r.r||!r.c)return null;var t=kmatrix.matrixMap(function(t,i,n){return kmatrix.cropMatrix(r,i,n)},r);return t},matrixTranspose:function(r){r=kmatrix.makeMatrix(r);var t=r.c,i=r.r;if(!t||!i)return null;var n=[];return _.times(t,function(t){var a=[];_.times(i,function(i){a.push(r[i][t])}),n.push(a)}),kmatrix.makeMatrix(n)},matrixDet:function(r){if(r=kmatrix.makeMatrix(r),r.r!==r.c)return null;var t,i,n,a,e,u,m,c,o,x;return 2===r.r?(t=r[0][0],i=r[0][1],n=r[1][0],a=r[1][1],x=t*a-i*n):3===r.r&&(t=r[0][0],i=r[0][1],n=r[0][2],a=r[1][0],e=r[1][1],u=r[1][2],m=r[2][0],c=r[2][1],o=r[2][2],x=t*(e*o-u*c)-i*(o*a-u*m)+n*(a*c-e*m)),x},matrixAdj:function(r){r=kmatrix.makeMatrix(r);var t,i,n,a,e,u,m,c,o,x;if(2===r.r)t=r[0][0],i=r[0][1],n=r[1][0],a=r[1][1],x=[[a,-i],[-n,t]];else if(3===r.r){t=r[0][0],i=r[0][1],n=r[0][2],a=r[1][0],e=r[1][1],u=r[1][2],m=r[2][0],c=r[2][1],o=r[2][2];var p=e*o-u*c,l=-(a*o-u*m),f=a*c-e*m,k=-(i*o-n*c),s=t*o-n*m,M=-(t*c-i*m),h=i*u-n*e,v=-(t*u-n*a),_=t*e-i*a;x=[[p,k,h],[l,s,v],[f,M,_]]}return x&&(x=kmatrix.makeMatrix(x)),x},matrixInverse:function(r,t){var i=kmatrix.matrixDet(r);if(!i)return null;var n=kmatrix.matrixAdj(r);if(!n)return null;var a=kmatrix.deepZipWith(2,function(r){return r/=i,t&&(r=KhanUtil.roundTo(t,r)),r},n);return a=kmatrix.makeMatrix(a)},matrixPad:function(r,t,i,n){if(!r)return null;r=kmatrix.makeMatrix(r);var a=kmatrix.matrixCopy(r),e=Math.max(i,r.c);void 0===n&&(n="");var u=i-a.c;u>0&&_.times(a.r,function(r){_.times(u,function(){a[r].push(n)})});var m=t-a.r;return m>0&&_.times(m,function(){var r=[];_.times(e,function(){r.push(n)}),a.push(r)}),kmatrix.makeMatrix(a)},arrayToColumn:function(r){var t=[];return _.each(r,function(r){t.push([r])}),kmatrix.makeMatrix(t)},columnToArray:function(r){var t=[];return _.each(r,function(r){t.push(r[0])}),t}};_.each(kmatrix,function(r,t){KhanUtil[t]=r}),module.exports=kmatrix;
},{"./expressions.js":2}]},{},[1]);
